<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>version</title>
    <link rel="stylesheet" href="../../vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="../../vendors/feather/feather.css">
    <link rel="stylesheet" href="../../vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="../../vendors/jquery-contextmenu/jquery.contextMenu.min.css">
    <link rel="stylesheet" th:href="@{/vendors/bootstrap-datepicker/bootstrap-datepicker.min.css}">
    <link rel="stylesheet" th:href="@{/vendors/jsgrid/jsgrid.min.css}">
    <link rel="stylesheet" th:href="@{/vendors/jsgrid/jsgrid-theme.min.css}">
    <link rel="stylesheet" th:href="@{/vendors/dropify/dropify.min.css}">
    <link rel="stylesheet" th:href="@{/vendors/jquery-toast-plugin/jquery.toast.min.css}">

    <link rel="stylesheet" href="../../css/vertical-layout-light/style.css">
    <style>
        .dropzone .dz-preview + .dz-preview {
            border-top: 0;
            padding-top: 0;
            border-left: 1px solid #e9e9e9;
            padding-left: .5rem;
        }
        .dropzone .dz-preview .dz-success-mark, .dropzone .dz-preview .dz-image {
            display: none;
        }
        .dropzone .dz-preview .dz-success-mark, .dropzone .dz-preview .dz-error-mark {
            display: none;
        }
        .dropzone .dz-preview .dz-success-mark, .dropzone .dz-preview .dz-success-mark {
            display: none;
        }
        /*.pricing-card {*/
        /*flex: 0 0 33% !important;*/
        /*}*/

        .ta-left {
            text-align: left;
        }

        /*.pricing-table .pricing-card .pricing-card-body {*/
        /*padding-top: 30px;*/
        /*padding-left: 10px;*/
        /*}*/

        .tab-content {
            padding: 1rem 1rem;
        }

        .jsgrid .jsgrid-table .jsgrid-filter-row input[type=text] {
            height: 20px;
        }

        .jsgrid-table .grid-select-my td {
            background-color: #c4e2ff;
        }

        #problemTable .grid-select-my td {
            background-color: #c4e2ff;
        }

        #screenShotTable .grid-select-my td {
            background-color: #c4e2ff;
        }

        .file-div {
            height: 200px;
            width: 100%;
            border-radius: 5px;
            border: 1px solid #e9e9e9;
            /*box-shadow: #888888 0px 0px 5px;*/
            /*line-height: 200px;*/
            /*margin-right: 15px;*/
            /*background-color: lightskyblue;*/
        }

        /*.dropzone .dz-preview .dz-details .dz-size {*/
        /*margin-top: 12px;*/
        /*margin-bottom: 12px;*/
        /*}*/

        /*.dropzone .dz-preview .dz-details .dz-size, .dropzone .dz-preview .dz-details .dz-filename {*/
        /*margin-top: 12px;*/
        /*margin-bottom: 12px;*/
        /*}*/

        /*#js-grid-report {*/
        /*height: 700px !important;*/
        /*}*/

        @media (min-width: 900px) {
            #funcProblemModal .modal-dialog {
                max-width: 800px;
                margin: 30px auto;
            }
        }

        @media (min-width: 900px) {
            #screenShotModal .modal-dialog {
                max-width: 800px;
                margin: 30px auto;
            }
        }

        @media (min-width: 900px) {
            #uploadModal .modal-dialog {
                max-width: 800px;
                margin: 30px auto;
            }
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-check {
            margin-top: 0;
            margin-bottom: 0;
        }

        .form-group label {
            margin-bottom: 0;
        }

        #funcProblemModal .modal-dialog .modal-content .modal-body {
            padding: 5px 35px!important;
        }

        #funcProblemModal input[disabled], #funcProblemModal textarea[disabled] {
            background-color: white;
        }

        .my-content ul li {
        //display: inline-block;
            margin-right: 5px;
        }

        .accordion .card .card-header {
            padding: 8px;
        }

        .table td .dropify-render img {
            width: auto;
            height: auto;
            border-radius: 0;
        }

        .circle-loader {
            width: 10px;
            height: 10px;
            margin-bottom: 5px;
        }

        .jsgrid .jsgrid-pager-current-page {
            padding: 0.25rem 0.5rem;
        }

        .page-link, .jsgrid .jsgrid-pager .jsgrid-pager-nav-button a, .jsgrid .jsgrid-pager .jsgrid-pager-page a {
            padding: 0.25rem 0.5rem;
        }

        .jsgrid-pager-nav-button {
            padding: 0;
        }

        .jsgrid-pager-page {
            padding: 0;
        }

        #js-grid-function .badge {
            font-size: 12px;
            padding: 2px;
        }

        #js-grid-function .jsgrid-filter-row td:nth-child(5) select option:nth-child(2) {
            color: #0AD7F7;
        }
        #js-grid-function .jsgrid-filter-row td:nth-child(5) select option:nth-child(3) {
            color: red;
        }
        #js-grid-function .jsgrid-filter-row td:nth-child(5) select option:nth-child(4) {
            color: #FCD539;
        }

        #js-grid-function .jsgrid-filter-row td:nth-child(6) select option:nth-child(2) {
            color: red;
        }
        #js-grid-function .jsgrid-filter-row td:nth-child(6) select option:nth-child(3) {
            color: green;
        }

        select.form-control, select.asColorPicker-input, .dataTables_wrapper select, .jsgrid .jsgrid-table .jsgrid-filter-row select, .select2-container--default select.select2-selection--single, .select2-container--default .select2-selection--single select.select2-search__field, select.typeahead, select.tt-query, select.tt-hint {
            padding: .4375rem .075rem;
            font-size: 12px;
        }

    </style>
</head>
<body onload="onLoad">
<div class="row container-scroller">
    <div class="col-12 grid-margin">
        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="func-tab" data-toggle="tab" href="#func-1" role="tab" aria-controls="func-1" aria-selected="false"
                   onclick="jsGridFunctionRefresh()">函数</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="problem-tab" data-toggle="tab" href="#problem-1" role="tab"
                   aria-controls="problem-1" aria-selected="true" onclick="clearToast()">问题单</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="doc-tab" data-toggle="tab" href="#doc-1" role="tab" aria-controls="doc-1"
                   aria-selected="false" onclick="clearToast()">文档管理</a>
            </li>
        </ul>
        <div class="tab-content" id="tab-content-firat">
            <div class="tab-pane fade show active" id="func-1" role="tabpanel" aria-labelledby="func-tab">
                <div class="row">
                    <div class="col-xl-5 col-lg-12 grid-margin">
                        <table class="table table-border">
                            <tr>
                                <td>
                                    <div style="margin-bottom: 5px;" id="func-statistic">
                                        <div style="display: inline-block;margin-right: 5px;">
                                            <span>统计信息:</span>
                                            <span>所有</span>
                                            <span v-text="all"></span>
                                            <span>未修改</span>
                                            <span v-text="old"></span>
                                            <span>修改</span>
                                            <span v-text="modify"></span>
                                            <span>新增</span>
                                            <span v-text="add"></span>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                        <div id="js-grid-function"></div>
                    </div>
                    <div class="col-xl-7 col-lg-12 grid-margin">
                        <div class="row" id="project-function-vue">
                            <div class="col-md-6 col-xl-6 grid-margin stretch-card">
                                <div class="card border-light border" id="card_comment">
                                    <div class="text-center p-2">
                                        <div v-show="haveSure" style="float: left; font-size: 10px; color: green;border: 1px solid green;">已确认</div>
                                        <div v-show="notHaveSure" style="float: left; font-size: 10px; color: red;border: 1px solid red;">未确认</div>
                                        <h3 style="margin-bottom: 0;">函数明细</h3>
                                    </div>
                                    <table class="table table-bordered">
                                        <tr>
                                            <td style="width: 65px;">名称</td>
                                            <td>
                                                <input v-model="name" style="width: 100%;border: 0;"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>说明</td>
                                            <td>
                                                <textarea rows="12" v-model="comment" style="line-height: 20px; border: 0; width: 100%;"></textarea>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 65px;">验证码</td>
                                            <td>
                                                <span v-text="hashValue" style="width: 100%;border: 0;"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 65px;">返回类型</td>
                                            <td>
                                                <span v-text="returnType" style="width: 100%;border: 0;"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 65px;">创建时间</td>
                                            <td>
                                                <span v-text="createTime" style="width: 100%;border: 0;"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 65px;">更新时间</td>
                                            <td>
                                                <span v-text="updateTime" style="width: 100%;border: 0;"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width: 65px;">全名</td>
                                            <td>
                                                <span v-text="fullName" style="width: 100%;border: 0;word-break:break-all;"/>
                                            </td>
                                        </tr>
                                    </table>
                                    <!--<div id="funcDescDisplay" style="height: 190px;width: 100%; padding: 5px;overflow: auto; display: none;" v-text="comment"></div>-->
                                    <!--<div id="funcDescEdit" style="padding: 5px;height: 200px;width: 100%;">-->
                                    <!--<textarea rows="11" v-text="comment" style="line-height: 20px; border: 0; width: 100%;"></textarea>-->
                                    <!--<button type="button" class="btn btn-link btn-fw float-right"-->
                                    <!--style="margin-top: 10px; margin-right: 5px;cursor:hand;">确定-->
                                    <!--</button>-->
                                    <!--<button type="button" class="btn btn-link btn-fw float-right"-->
                                    <!--style="margin-top: 10px; margin-right: 5px;cursor:hand;">取消-->
                                    <!--</button>-->
                                    <!--</div>-->
                                </div>
                            </div>
                            <div class="col-md-6 col-xl-6 grid-margin stretch-card pricing-card">
                                <div class="card border-light border pricing-card-body" id="card_var">
                                    <div class="text-center p-2">
                                        <h3 style="margin-bottom: 0;">全局变量</h3>
                                    </div>
                                    <div class="my-content" style="height: 160px;width: 100%; padding: -1px;overflow: auto;">
                                        <!--<ul class="list-star">-->
                                        <!--&lt;!&ndash;<li th:each="varObj : ${function.varList}" th:text="${varObj.name}">Email preview on air</li>&ndash;&gt;-->
                                        <!--<li v-for="item in globalVar">-->
                                        <!--<span v-text="item.name"></span>-->
                                        <!--<span>[</span>-->
                                        <!--<span>类名:</span>-->
                                        <!--<span v-text="item.cls"></span>-->
                                        <!--<span>默认值:</span>-->
                                        <!--<span v-text="item.val"></span>-->
                                        <!--<span>]</span>-->
                                        <!--</li>-->
                                        <!--</ul>-->
                                        <table class="table table-bordered" >
                                            <tr>
                                                <td style="width: 65px;">描述</td>
                                                <td colspan="5">
                                                    <!--<input v-bind:value="globalVarCpmment" style="width: 100%;"/>-->
                                                    <textarea rows="2" v-model="globalVarCpmment" style="line-height: 20px; border: 0; width: 100%;"></textarea>
                                                </td>
                                            </tr>
                                            <tr v-for="item in globalVar">
                                                <td>名称</td>
                                                <td v-text="item.name"></td>
                                                <td>类名</td>
                                                <td v-text="item.cls"></td>
                                                <!--<td>默认值</td>-->
                                                <!--<td v-text="item.val"></td>-->
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="text-center" style="border-top: #eaeaea 1px solid;">
                                        <h3 style="margin: 8px;">参数</h3>
                                    </div>
                                    <div class="my-content" style="height: 250px;width: 100%; padding: -1px;overflow: auto;">
                                        <!--<ul class="list-star">-->
                                        <!--<li v-for="item in param">-->
                                        <!--<span v-text="item.name"></span>-->
                                        <!--<span>[</span>-->
                                        <!--<span>类名:</span>-->
                                        <!--<span v-text="item.cls"></span>-->
                                        <!--<span>类型:</span>-->
                                        <!--<span v-text="item.type"></span>-->
                                        <!--<span>默认值:</span>-->
                                        <!--<span v-text="item.val"></span>-->
                                        <!--<span>]</span>-->
                                        <!--</li>-->
                                        <!--</ul>-->
                                        <table class="table table-bordered" >
                                            <tr>
                                                <td style="width: 65px;">输入说明</td>
                                                <td colspan="5">
                                                    <!--<input v-bind:value="globalVarCpmment" style="width: 100%;"/>-->
                                                    <textarea rows="2" v-model="paramInComment" style="line-height: 20px; border: 0; width: 100%;"></textarea>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>输出说明</td>
                                                <td colspan="5">
                                                    <!--<input v-bind:value="globalVarCpmment" style="width: 100%;"/>-->
                                                    <textarea rows="2" v-model="paramOutComment" style="line-height: 20px; border: 0; width: 100%;"></textarea>
                                                </td>
                                            </tr>
                                            <tr v-for="item in param">
                                                <td>名称</td>
                                                <td v-text="item.name"></td>
                                                <td>类名</td>
                                                <td v-text="item.cls"></td>
                                                <td>类型</td>
                                                <td v-text="item.type"></td>
                                                <!--<td>默认值</td>-->
                                                <!--<td v-text="item.val"></td>-->
                                            </tr>
                                        </table>
                                    </div>
                                    <!--<hr/>-->
                                    <!--<div class="text-center">-->
                                    <!--<h3>输出</h3>-->
                                    <!--</div>-->
                                    <!--<div class="my-content" style="height: 200px;width: 100%; padding: 5px;overflow: auto;">-->
                                    <!--<ul class="list-star">-->
                                    <!--<li v-for="item in output" v-text="item"></li>-->
                                    <!--</ul>-->
                                    <!--</div>-->
                                </div>
                            </div>
                            <div class="col-md-6 col-xl-6 grid-margin stretch-card">
                                <div class="card border-light border">
                                    <div class="text-center p-2">
                                        <h3>函数调用关系</h3>
                                    </div>
                                    <div id="funcChart" class="funcChart"
                                         style="height: 300px; width: 100%;"></div>
                                </div>
                            </div>
                            <div class="col-md-6 col-xl-6 grid-margin stretch-card pricing-card">
                                <div class="card border-light border">
                                    <div class="">
                                        <div class="accordion" id="accordion-4"
                                             role="tablist">
                                            <div class="card">
                                                <div class="card-header" role="tab" id="heading-10">
                                                    <h3 class="mb-0" style="font-size: 1.25rem;">
                                                        <a data-toggle="collapse" href="#collapse-10"
                                                           aria-expanded="true" aria-controls="collapse-10">
                                                            问题单
                                                        </a>
                                                    </h3>
                                                </div>
                                                <div id="collapse-10" class="collapse show" role="tabpanel"
                                                     aria-labelledby="heading-10" data-parent="#accordion-4">
                                                    <div class="table-responsive">
                                                        <div style="width: 100%; height: 100px; overflow: auto;">
                                                            <table class="table table-striped table-hover"
                                                                   id="problemTable" style="border-top: #cccccc solid 1px;">
                                                                <thead>
                                                                <tr>
                                                                    <th style="display: none">
                                                                        ID
                                                                    </th>
                                                                    <th>
                                                                        测试人
                                                                    </th>
                                                                    <th>
                                                                        测试时间
                                                                    </th>
                                                                    <th>
                                                                        问题描述
                                                                    </th>
                                                                </tr>
                                                                </thead>
                                                                <tbody>
                                                                <tr v-for="item in problemList" v-bind:class="problemTbSelected(item.id)" v-on:click="problemTbRowClick(item.id)">
                                                                    <td v-text="item.id" style="display: none;"></td>
                                                                    <td v-text="item.testPerson">
                                                                        测试人
                                                                    </td>
                                                                    <td v-text="item.testTime">
                                                                        测试时间
                                                                    </td>
                                                                    <td>
                                                                        <div v-text="item.problemDescription" style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;height:15px;width:100px;">
                                                                            问题描述
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="card">
                                                <div class="card-header" role="tab" id="heading-11">
                                                    <h3 class="mb-0" style="font-size: 1.25rem;">
                                                        <a class="collapsed" data-toggle="collapse"
                                                           href="#collapse-11" aria-expanded="false"
                                                           aria-controls="collapse-11">
                                                            tcf文件
                                                        </a>
                                                    </h3>
                                                </div>
                                                <div id="collapse-11" class="collapse" role="tabpanel"
                                                     aria-labelledby="heading-11" data-parent="#accordion-4">
                                                    <div class="table-responsive">
                                                        <div style="width: 100%; height: 100px; overflow: auto;">
                                                            <table class="table table-striped table-hover"
                                                                   id="tcfTable" style="border-top: #cccccc solid 1px;">
                                                                <thead>
                                                                <tr>
                                                                    <th style="display: none;">
                                                                        ID
                                                                    </th>
                                                                    <th>
                                                                        文件名
                                                                    </th>
                                                                    <th>
                                                                        创建人
                                                                    </th>
                                                                    <th>
                                                                        创建时间
                                                                    </th>
                                                                </tr>
                                                                </thead>
                                                                <tbody>
                                                                <tr v-for="item in tcfList">
                                                                    <td v-text="item.id" style="display: none;"></td>
                                                                    <td>
                                                                        <a v-text="item.fileName" v-bind:href="item.href">
                                                                            测试
                                                                        </a>
                                                                    </td>
                                                                    <td v-text="item.creatPerson">
                                                                        测试
                                                                    </td>
                                                                    <td v-text="formatDate(item.creatTime)">
                                                                        May 15, 2015
                                                                    </td>
                                                                </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="card">
                                                <div class="card-header" role="tab" id="heading-12">
                                                    <h3 class="mb-0" style="font-size: 1.25rem;">
                                                        <a class="collapsed" data-toggle="collapse"
                                                           href="#collapse-12" aria-expanded="false"
                                                           aria-controls="collapse-12">
                                                            覆盖率文件
                                                        </a>
                                                    </h3>
                                                </div>
                                                <div id="collapse-12" class="collapse" role="tabpanel"
                                                     aria-labelledby="heading-12" data-parent="#accordion-4">
                                                    <div class="table-responsive">
                                                        <div style="width: 100%; height: 100px; overflow: auto;">
                                                            <table class="table table-striped table-hover"
                                                                   id="coverageTable" style="border-top: #cccccc solid 1px;">
                                                                <thead>
                                                                <tr>
                                                                    <th style="display: none">
                                                                        ID
                                                                    </th>
                                                                    <th>
                                                                        文件名
                                                                    </th>
                                                                    <th style="min-width: 45px;">语句</th>
                                                                    <th style="min-width: 45px;">分支</th>
                                                                    <th style="min-width: 50px;">MC/DC</th>
                                                                    <th style="min-width: 80px;">
                                                                        创建人
                                                                    </th>
                                                                    <th style="min-width: 80px;">
                                                                        创建时间
                                                                    </th>
                                                                </tr>
                                                                </thead>
                                                                <tbody>
                                                                <tr v-for="item in coverageList">
                                                                    <td v-text="item.id" style="display: none;"></td>
                                                                    <td >
                                                                        <a v-text="item.fileName" v-bind:href="item.href">
                                                                            测试
                                                                        </a>
                                                                    </td>
                                                                    <td v-text="item.statementCoverage"></td>
                                                                    <td v-text="item.branchCoverageShow"></td>
                                                                    <td v-text="item.mcdcCoverage"></td>
                                                                    <td v-text="item.creatPerson">
                                                                        测试
                                                                    </td>
                                                                    <td v-text="formatDate(item.creatTime)">
                                                                        May 15, 2015
                                                                    </td>
                                                                </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="card">
                                                <div class="card-header" role="tab" id="heading-13">
                                                    <h3 class="mb-0" style="font-size: 1.25rem;">
                                                        <a class="collapsed" data-toggle="collapse"
                                                           href="#collapse-13" aria-expanded="false"
                                                           aria-controls="collapse-12">
                                                            截图文件
                                                        </a>
                                                    </h3>
                                                </div>
                                                <div id="collapse-13" class="collapse" role="tabpanel"
                                                     aria-labelledby="heading-12" data-parent="#accordion-4">
                                                    <div class="table-responsive">
                                                        <div style="width: 100%; height: 130px; overflow: auto;">
                                                            <table class="table table-striped table-hover"
                                                                   id="screenShotTable" style="border-top: #cccccc solid 1px;" v-if="!screenShotMode">
                                                                <thead>
                                                                <tr>
                                                                    <th style="display: none;">
                                                                        ID
                                                                    </th>
                                                                    <th>
                                                                        文件名
                                                                    </th>
                                                                    <th style="min-width: 78px;">
                                                                        文件类型
                                                                    </th>
                                                                    <th style="min-width: 80px;">
                                                                        创建人
                                                                    </th>
                                                                    <th style="min-width: 80px;">
                                                                        创建时间
                                                                    </th>
                                                                </tr>
                                                                </thead>
                                                                <tbody>
                                                                <tr v-for="item in screenShotList" v-bind:class="screenShotTbSelected(item.id)" v-on:click="screenShotTbRowClick(item.id)">
                                                                    <td v-text="item.id" style="display: none;"></td>
                                                                    <td>
                                                                        <a v-text="item.fileName" v-bind:href="item.href">
                                                                            测试
                                                                        </a>
                                                                    </td>
                                                                    <td v-text="item.pictureType">

                                                                    </td>
                                                                    <td v-text="item.creatPerson">
                                                                        测试
                                                                    </td>
                                                                    <td v-text="formatDate(item.creatTime)">
                                                                        May 15, 2015
                                                                    </td>
                                                                </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="problem-1" role="tabpanel" aria-labelledby="problem-tab">
                <div class="row">
                    <div class="col-12 grid-margin">
                        <div id="js-grid-problem"></div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="doc-1" role="tabpanel" aria-labelledby="doc-tab">
                <div class="col-md-12 col-xl-12 grid-margin stretch-card">
                    <div class="card" style="border: 0;">
                        <!--<h4 class="card-title">上传文档</h4>-->
                        <!--<p class="card-description">Basic nav pills</p>-->
                        <ul class="nav nav-pills nav-pills-success" id="pills-tab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link" id="pills-tcf-tab" data-toggle="pill" href="#pills-tcf"
                                   role="tab" aria-controls="pills-tcf" aria-selected="false" onclick="jsGridFileRefresh()">文档上传</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="pills-coverage-tab" data-toggle="pill"
                                   href="#pills-coverage" role="tab" aria-controls="pills-coverage"
                                   aria-selected="true" onclick="jsGridFunctionFullRefresh()">文档完整性分析</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" id="pills-report-tab" data-toggle="pill"
                                   href="#pills-report" role="tab" aria-controls="pills-report"
                                   aria-selected="true" onclick="jsGridReportRefresh()">报告生成</a>
                            </li>
                        </ul>
                        <div class="tab-content" id="docs-tabContent">
                            <div class="tab-pane fade" id="pills-tcf" role="tabpanel"
                                 aria-labelledby="pills-tcf-tab">
                                <div>
                                    <div class="d-flex flex-nowrap">
                                        <h5 class="" style="margin: 0;width: 80px;">文档上传</h5>
                                        <div id="analysisIng" style="display: none;width: 100px;">
                                            <div class="circle-loader" style="display: inline-block;margin-right: 10px;"></div>
                                            <span>解析中...</span>
                                        </div>
                                        <div id="analysisComplete" style="display: none;width: 100px;">
                                            解析完成
                                        </div>
                                        <div id="tcf-progress" class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <div class="dropzone d-flex align-items-center"
                                         id="tcf-dropzone" style="height: 100px;width: 100%;overflow: auto;"></div>
                                    <h5 class="mt-2">
                                        <a th:href="'/file-upload/downloadNoChange?project='+${project}+'&version='+${version}" style="width: 140px;">下载当前版本文档</a>
                                        解析结果 <span id="uploadResult"></span>
                                        <div style="display: inline-block;float: right;">
                                            <span>测试报告模板: </span>
                                            <a id="wordmuban" style="color: red;">模板未上传</a>
                                            <span>说明报告模板: </span>
                                            <a id="explainmuban" style="color: red;">模板未上传</a>
                                        </div>
                                    </h5>
                                    <div class="row">
                                        <div class="col-xl-3 col-lg-12">
                                            <div id="js-grid-tcf"></div>
                                        </div>
                                        <div class="col-xl-5 col-lg-12">
                                            <div id="js-grid-coverage"></div>
                                        </div>
                                        <div class="col-xl-4 col-lg-12">
                                            <div id="js-grid-picture"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="pills-coverage" role="tabpanel"
                                 aria-labelledby="pills-coverage-tab">
                                <div class="row">
                                    <div class="col-12">
                                        <!--<div class="d-flex flex-nowrap">-->
                                        <!--<h5 class="" style="margin: 0;width: 80px;">文档上传</h5>-->
                                        <!--<div id="coverage-progress" class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>-->
                                        <!--</div>-->
                                        <!--<div class="dropzone d-flex align-items-center"-->
                                        <!--id="converage-dropzone" style="height: 100px;width: 100%;overflow: auto;"></div>-->
                                        <!--<h5 class="mt-2">解析结果</h5>-->

                                        <!--<button class="btn btn-link" style="float: right;padding: 0;cursor: hand;" v-on:click="showSearch = !showSearch">-->
                                        <!--查询-->
                                        <!--</button>-->
                                        <form id="func-search-vue">
                                            <table class="table table-bordered" style="margin-bottom: 5px;">
                                                <tr>
                                                    <td style="width: 20%;">问题类型</td>
                                                    <td>
                                                        <div class="form-group" id="exampleInputError">
                                                            <div class="form-check" style="display: inline-block;margin-top: 5px;">
                                                                <label class="form-check-label">
                                                                    <input type="checkbox" class="form-check-input" v-model="optionProblem">
                                                                    未填写问题单
                                                                    <i class="input-helper"></i></label>
                                                            </div>
                                                            <div class="form-check" style="display: inline-block;margin-top: 5px;">
                                                                <label class="form-check-label">
                                                                    <input type="checkbox" class="form-check-input" v-model="optionTcf">
                                                                    未上传tcf文件
                                                                    <i class="input-helper"></i></label>
                                                            </div>
                                                            <div class="form-check" style="display: inline-block;margin-top: 5px;">
                                                                <label class="form-check-label">
                                                                    <input type="checkbox" class="form-check-input" v-model="optionCoverage">
                                                                    未上传覆盖率文件
                                                                    <i class="input-helper"></i></label>
                                                            </div>
                                                            <div class="form-check" style="display: inline-block;margin-top: 5px;">
                                                                <label class="form-check-label">
                                                                    <input type="checkbox" class="form-check-input" v-model="optionPicture">
                                                                    未上传截图文件
                                                                    <i class="input-helper"></i></label>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>函数类型</td>
                                                    <td>
                                                        <div class="form-group" id="exampleInputErrorLevel">
                                                            <div class="form-check" style="display: inline-block; margin-right: 5px;">
                                                                <label class="form-check-label">
                                                                    <input type="radio" class="form-check-input" value="-1" v-model="type" >
                                                                    所有
                                                                    <i class="input-helper"></i>
                                                                </label>
                                                            </div>
                                                            <div class="form-check" style="display: inline-block; margin-right: 5px;">
                                                                <label class="form-check-label">
                                                                    <input type="radio" class="form-check-input" value="0" v-model="type">
                                                                    未修改
                                                                    <i class="input-helper"></i>
                                                                </label>
                                                            </div>
                                                            <div class="form-check" style="display: inline-block; margin-right: 5px;">
                                                                <label class="form-check-label">
                                                                    <input type="radio" class="form-check-input" value="1" v-model="type">
                                                                    修改
                                                                    <i class="input-helper"></i>
                                                                </label>
                                                            </div>
                                                            <div class="form-check" style="display: inline-block; margin-right: 5px;">
                                                                <label class="form-check-label">
                                                                    <input type="radio" class="form-check-input" value="2" v-model="type">
                                                                    新增
                                                                    <i class="input-helper"></i>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td></td>
                                                    <td>
                                                        <div class="d-flex flex-row-reverse">
                                                            <button class="btn btn-sm btn-outline-light btn-rounded" style="width: 65px;" v-on:click="search">查询</button>
                                                            <!--<button class="btn btn-sm btn-outline-light btn-rounded" style="width: 65px; margin-right: 5px;">取消</button>-->
                                                        </div>
                                                    </td>
                                                </tr>
                                            </table>
                                        </form>
                                        <div id="js-grid-function-full"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade active show" id="pills-report" role="tabpanel"
                                 aria-labelledby="pills-report-tab">
                                <h5>生成报告</h5>
                                <div class="row">
                                    <div class="col-12">
                                        <!--<form class="form-inline">-->
                                        <!--<div class="col-1">-->
                                        <!--<label for="reportName">报告名称</label>-->
                                        <!--</div>-->
                                        <!--<div class="col-4">-->
                                        <!--<input type="text" class="form-control" id="reportName" placeholder="报告名称" style="width: 100%;">-->
                                        <!--</div>-->
                                        <!--<div class="col-1">-->
                                        <!--<label for="reportDesc">报告描述</label>-->
                                        <!--</div>-->
                                        <!--<div class="col-4">-->
                                        <!--<input type="text" class="form-control" id="reportDesc" placeholder="报告描述" style="width: 100%;">-->
                                        <!--</div>-->
                                        <!--<div class="col-2">-->
                                        <!--<button id="reportBtn" class="btn btn-primary float-right" onclick="produceReport(event)">-->
                                        <!--生成报告-->
                                        <!--<div id="reportCircle" class="circle-loader" style="display: none;"></div>-->
                                        <!--</button>-->
                                        <!--</div>-->
                                        <!--</form>-->
                                        <div style="float: right">
                                            <select id="selector_fileType" class="flex-fill" style="height: 38px;margin-right:8px;border-radius: 5px;border-color: #eaeaea;">
                                                <option value="1" selected>测试报告</option>
                                                <option value="2">说明报告</option>
                                            </select>
                                            <button id="reportBtn" class="btn btn-primary" onclick="produceReport(event)">
                                                生成报告
                                                <div id="reportCircle" class="circle-loader" style="display: none;"></div>
                                            </button>
                                            <button class="btn btn-info" onclick="refreshReport(event)">
                                                刷新
                                            </button>
                                        </div>
                                    </div>
                                    <div id="js-grid-report" class="mt-3"></div>
                                </div>
                                <!--<div class="text-center file-div" style="">-->
                                <!--<a href="#">xxx.rar</a>-->
                                <!--</div>-->

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--<div class="tab-pane fade" id="report-1" role="tabpanel" aria-labelledby="report-tab">-->

            <!--</div>-->
        </div>
    </div>
</div>

<div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uploadModalLabel">上传单个文件</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="card" id="sigenal-upload-card">
                <div class="card-body" style="padding: 28px;">
                    <div class="row">
                        <div class="col-12 mx-auto">
                            <div class="row d-flex flex-nowrap" style="margin-left: 0; margin-bottom: 8px;">
                                <span style="padding-top: 8px; width: 50px;">类型：</span>
                                <select v-model="fileType" class="form-control" style="width: 200px;" v-on:change="onChange">
                                    <option v-for="item in fileTypeList" v-text="item.label" v-bind:value="item.value"></option>
                                </select>
                                <select v-model="pictureType" class="form-control" style="width: 200px; margin-left: 20px;" v-show="fileType===3" v-on:change="onChange">
                                    <option v-for="item in pictureTypeList" v-text="item.label" v-bind:value="item.value"></option>
                                </select>
                            </div>
                            <div class="d-flex flex-nowrap">
                                <div style="width: 100px;" v-show="analysisIngS">
                                    <div class="circle-loader" style="display: inline-block;margin-right: 10px;"></div>
                                    解析中...
                                </div>
                                <div style="width: 100px;" v-show="analysisCompleteS">
                                    解析完成
                                </div>
                                <div id="sigenal-progress" class="progress-bar bg-success" role="progressbar"
                                     style="height:16px;display: inline-block;"
                                     v-bind:style="progressValuePercent" v-bind:aria-valuenow="progressValue"
                                     aria-valuemin="0" aria-valuemax="100">{{progressValueText}}</div>
                            </div>
                            <div class="d-flex align-items-center dropzone"
                                 id="sigenal-dropzone" style="height: 140px;width: 100%;overflow: auto;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!--<div class="modal-footer">-->
            <!---->
            <!--</div>-->
        </div>
    </div>
</div>

<div class="modal fade" id="screenShotModal" tabindex="-1" role="dialog" aria-labelledby="screenShotModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="screenShotModalLabel">截图文件</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-12">
                        <table class="table table-bordered" style="width: 100%;">
                            <!--<thead>-->
                            <!--<th colspan="4" class="text-center">单元测试问题单</th>-->
                            <!--</thead>-->
                            <tbody>
                            <tr>
                                <td style="width: 15%;">文件类型</td>
                                <td style="width: 85%;">
                                    <select class="form-control" id="screenShotType" v-bind:data-value="type">
                                        <option value="1">测试路径概要</option>
                                        <option value="2">语句覆盖率</option>
                                        <option value="3">分支覆盖率</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>文件</td>
                                <td>
                                    <input type="file" class="dropify" v-bind:data-default-file="src"/>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-12">
                        <hr/>
                        <div class="d-flex flex-row-reverse">
                            <button class="btn btn-outline-light btn-rounded" style="width: 85px;">确定</button>
                            <button class="btn btn-outline-light btn-rounded" style="width: 85px; margin-right: 5px;">取消</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="@{/commons/_problem_modal} :: funcProblemModal"/>

<script src="../../vendors/js/vendor.bundle.base.js"></script>
<script th:src="@{/vendors/jquery-contextmenu/jquery.contextMenu.min.js}"></script>
<script th:src="@{/vendors/echarts/echarts.js}"></script>
<script th:src="@{/vendors/jsgrid/jsgrid.min.js}"></script>
<script th:src="@{/vendors/dropzone/dropzone.js}"></script>
<script th:src="@{/vendors/dropify/dropify.min.js}"></script>
<script th:src="@{/js/jquery-ui.js}"></script>
<script th:src="@{/vendors/bootstrap-datepicker/bootstrap-datepicker.min.js}"></script>
<script th:src="@{/vendors/MergeCell.js}"></script>
<script th:src="@{/vendors/sweetalert/sweetalert.min.js}"></script>
<script th:src="@{/vendors/vue/vue.js}"></script>
<script src="../../../../js/file-upload.js"></script>
<script th:src="@{/myjs/db.js}"></script>
<script th:src="@{/myjs/problem-modal.js}"></script>
<script th:src="@{/vendors/jquery-toast-plugin/jquery.toast.min.js}"></script>
<script th:src="@{/myjs/comment.js}"></script>

<script type="text/javascript" th:inline="javascript">
    Dropzone.autoDiscover = false;
    var w, h;
    var modifyList = [
        {Id: -1, Name: ''},
        {Id: 0, Name: '未修改'},
        {Id: 1, Name: '修改'},
        {Id: 2, Name: '新增'}
    ];
    var affirmList = [
        {Id: -1, Name: ''},
        {Id: 0, Name: '未确认'},
        {Id: 1, Name: '已确认'}
    ];
    var jsGridFunctionItem;
    var functionItem;
    var funcRelationData = {
        self: { },
        parent: [
        ],
        child: [
        ]
    };
    var jsGridProblemItem = {id: 0};
    //问题单ID
    var problemId;
    //项目ID
    var projectId;
    //项目版本
    var projectVersion;
    //菜单操作类型
    var problemOrdertype;

    //
    var projectFunctionVue;
    //测试时间

    //函数名
    var functionName;

    //项目名
    var projectName;

    function onLoad() {
        resize();
    }

    function resize() {
        w = window.innerWidth
            || document.documentElement.clientWidth
            || document.body.clientWidth;

        h = window.innerHeight
            || document.documentElement.clientHeight
            || document.body.clientHeight;
        // if(w < 1370) {
        //     $(".tab-content-firat").css("height", "2050px");
        // } else {
        //     $(".tab-content-firat").css("height", 930-43+"px");
        // }
    }

    window.onresize = function () {
        resize();
    };
    function loadFunc(funcRelationData) {
        var option = {
            title: {
                // text: '函数关系图'
            },
            tooltip: {
                // formatter : '{b0}:<br/>{c0}'
                formatter: function (params) {
                    // console.log(params); // 当我们想要自定义提示框内容时，可以先将鼠标悬浮的数据打印出来，然后根据需求提取出来即可
                    if(params.data.fullName !== undefined && params.data.fullName !== null){ //显示函数的全名，需后台返回数据
                        return params.data.fullName;
                    }else{
                        return params.data.name;
                    }
                }
            },
            //数据更新动画的时长。
            animationDurationUpdate: 500,
            //数据更新动画的缓动效果。
            animationEasingUpdate: 'quinticInOut',
            series: [
                {
                    type: 'graph',
                    layout: 'none',
                    symbol: 'circle',
                    //symbol: 'recent',
                    //节点大小
                    symbolSize: [40, 40],
                    //roam: true,
                    //节点文字是否显示
                    label: {
                        normal: {
                            show: true,
                            backgroundColor: ''
                        }
                    },
                    itemStyle: {
                        normal: {
                            shadowColor: 'rgba(0,255,255,0.95)',
                            shadowBlur: 5,
                            borderRadius: 5
                        }
                    },
                    //指向箭头
                    edgeSymbol: ['circle', 'arrow'],
                    //edgeSymbolSize: [1, 10],
                    //连接线文字大小
                    edgeLabel: {
                        normal: {
                            textStyle: {
                                fontSize: 5
                            }
                        }
                    },
                    // focusNodeAdjacency: false,
                    data: [{
                        name: 'Func1',
                        fullName: 'fullName1',
                        x: 250,
                        y: -100
                    }, {
                        name: 'Func2',
                        fullName: 'fullName2',
                        x: 100,
                        y: 100
                    }, {
                        name: 'Func3',
                        fullName: 'fullName3',
                        x: 300,
                        y: 100
                    }, {
                        name: 'Func4',
                        fullName: 'fullName4',
                        x: 400,
                        y: 300
                    }, {
                        name: 'Func5',
                        fullName: 'fullName5',
                        x: 200,
                        y: 300
                    }],
                    // links: [],
                    links: [{
                        //起点
                        source: "Func1",
                        //终点
                        target: "Func2",
                        symbolSize: [4, 7],
                        label: {
                            normal: {
                                show: true,
                                fontSize: 8
                            }
                        },
                        lineStyle: {
                            normal: {
                                width: 1,
                                curveness: 0.2
                            }
                        }
                    }, {
                        source: 'Func2',
                        target: 'Func1',
                        label: {
                            normal: {
                                show: true,
                                fontSize: 8
                            }
                        },
                        lineStyle: {
                            normal: {curveness: 0.2}
                        }
                    }, {
                        source: 'Func1',
                        target: 'Func3'
                    }, {
                        source: 'Func2',
                        target: 'Func3'
                    }, {
                        source: 'Func3',
                        target: 'Func4'
                    }, {
                        source: 'Func3',
                        target: 'Func5'
                    }, {
                        source: 'Func4',
                        target: 'Func4'
                    }],
                    lineStyle: {
                        normal: {
                            opacity: 0.9,
                            width: 2,
                            curveness: 0
                        }
                    }
                }
            ]
        };
        if(funcRelationData){
            option.series[0].data = [];
            option.series[0].links = [];
            var j=funcRelationData.parent.length;
            var k=funcRelationData.child.length;
            if(funcRelationData.self){
                var x=0;
                if(k<j){
                    x = (400/j)*(j/2);
                }else if(j<k){
                    x = (400/k)*(k/2);
                }else{
                    if(k==0){
                        x=200;
                    }else{
                        x = (400/k)*(k/2);
                    }
                }
                option.series[0].data.push({id: funcRelationData.self.id, name: funcRelationData.self.name,fullName: funcRelationData.self.fullName, x: x, y: 100});
            }
            if(funcRelationData.parent){
                for(var i=0; i<j; i++){
                    option.series[0].data.push({id: funcRelationData.parent[i].procedureId, name: funcRelationData.parent[i].name, fullName: funcRelationData.parent[i].fullName, x: i*(400/j), y: -100});
                    //option.series[0].links.push({source: funcRelationData.parent[i].id, target: funcRelationData.self.id});
                    option.series[0].links.push({source: i+1, target: 0});
                }
            }
            if(funcRelationData.child){
                for(var i=0; i<k; i++){
                    option.series[0].data.push({id: funcRelationData.child[i].calledId, name: funcRelationData.child[i].name, fullName: funcRelationData.child[i].fullName, x: i*(400/k), y: 300});
                    //option.series[0].links.push({source: funcRelationData.self.id, target: funcRelationData.child[i].id});
                    option.series[0].links.push({source: 0, target: j+i+1});
                }
            }
        }
        return option;
    }

    function funcGridClick() {
        $("tbody tr").click(function () { //给每个tr 绑定点击事件 主要锁定每个tr
            var trs = $(this).parent().find('tr'); //获取所有tr
            if (trs.hasClass('grid-select-my')) { //判断这些tr 有没有Class ‘on’’
                trs.removeClass('grid-select-my');//把class on 移除
            }
            $(this).addClass('grid-select-my');//点击的tr 添加 on class 用于改变样式
        });
    }

    // function merge() {
    //     if($("#js-grid-coverage .jsgrid-grid-body .jsgrid-row").length){
    //         $("#js-grid-coverage .jsgrid-grid-body .jsgrid-table").mergeCell({
    //             cols:[0] ///参数为要合并的列，例如[0,5],表示第0和第5列
    //         })
    //     }
    // }

    function progressChange(progress, value) {
        var tag = $("#"+progress);
        var intValue = parseInt(value);
        tag.css("width", intValue + "%");
        tag.attr("aria-valuenow", parseInt(value));
        tag.text(parseInt(value) + "%");
        if(intValue == 100){
            $("#analysisIng").css("display", "inline-block");
            $("#analysisComplete").css("display", "none");
        }
    }

    function openScreenShotModal() {
        $('#screenShotModal').modal('show');
    }

    function updateFunComment(projectFunctionVue) {
        if(!functionItem){
            $.showWarningToast("请先选择一个函数.");
            return;
        }
        if(!projectFunctionVue.comment){
            $.showWarningToast("函数说明为空,无法确认.");
            return;
        }
        if(projectFunctionVue.comment.length >= 2245){
            $.showWarningToast("函数说明不能超过2245个字符.");
            return;
        }
        if(!projectFunctionVue.paramInComment){
            $.showWarningToast("输入说明为空,无法确认.");
            return;
        }
        if(projectFunctionVue.paramInComment.length >= 1245){
            $.showWarningToast("输入说明不能超过1245个字符.");
            return;
        }
        if(!projectFunctionVue.paramOutComment){
            $.showWarningToast("输出说明为空,无法确认.");
            return;
        }
        if(projectFunctionVue.paramOutComment.length >= 1245){
            $.showWarningToast("输出说明不能超过1245个字符.");
            return;
        }
        var data = {
            procedureId: functionItem.id,
            name: projectFunctionVue.name,
            comment: projectFunctionVue.comment,
            varDescription: projectFunctionVue.globalVarCpmment,
            inputDescription: projectFunctionVue.paramInComment,
            outputDescription: projectFunctionVue.paramOutComment
        };
        $.ajax({
            type: "post",
            url: "/fundesc/add",
            contentType: "application/json",
            dataType: "json",
            data: JSON.stringify(data),
            success: function(result){
                if(result.code == 0){
                    projectFunctionVue.haveSure = true;
                    projectFunctionVue.notHaveSure = false;
                    $.showSuccessToast("更新成功.");
                    $("#js-grid-function").jsGrid("search");
                    // var value= $("#js-grid-function .jsgrid-filter-row td:nth-child(6) select").val();
                    // var valueFun= $("#js-grid-function .jsgrid-filter-row td:nth-child(2) input").val();
                    // if(value === "-1" && valueFun == ""){
                    //     $("#js-grid-function").jsGrid("render");
                    // }
                }
            },
            error: function(data){

            }
        });
    }

    function showLastFunComment(projectFunctionVue){
        if(!functionItem){
            $.showWarningToast("请先选择一个函数.");
            return;
        }
        $.ajax({
            type: "post",
            url: "/fundesc/selectByFullName?fullName=" + functionItem.fullName,
            contentType: "application/json",
            dataType: "json",
            success: function(result){
                if(result.code == 0){
                    if(result.data.list.length == 0){
                        $.showWarningToast("未找到最新信息.")
                    }else if(result.data.list.length > 0){
                        //projectFunctionVue.name = result.data.list[0].name;
                        projectFunctionVue.comment = result.data.list[0].comment;
                        //projectFunctionVue.globalVarCpmment = result.data.list[0].varDescription;
                        projectFunctionVue.paramInComment = result.data.list[0].inputDescription;
                        projectFunctionVue.paramOutComment = result.data.list[0].outputDescription;
                    }
                }
            },
            error: function(data){

            }
        });
    }

    //文件上传解析完成以后刷新表格
    function refreshFileTable() {
        $("#js-grid-coverage").jsGrid("render").done(function() {
            // console.log("rendering completed and data loaded");
        });
        $("#js-grid-tcf").jsGrid("render");
        $("#js-grid-picture").jsGrid("render");
        getWordmuban(1);
        getWordmuban(2);
    }

    function clearToast() {
        $(".jq-toast-wrap .jq-icon-warning").css("display", "none");
        $(".jq-toast-wrap .jq-icon-success").css("display", "none");
        $(".jq-toast-wrap .jq-icon-error").css("display", "none");
    }

    function jsGridFileRefresh() {
        clearToast();
        setTimeout(function(){
            $("#js-grid-coverage").jsGrid("refresh");
            $("#js-grid-tcf").jsGrid("refresh");
            $("#js-grid-picture").jsGrid("refresh");
        },100);
    }

    function jsGridFunctionRefresh() {
        clearToast();
        $("#js-grid-function .jsgrid-grid-body").css("height", "677px");
        setTimeout(function(){
            $("#js-grid-function").jsGrid("refresh");
            funcGridClick();
        },500);
    }

    // 解决js-grid分页不显示
    function jsGridFunctionFullRefresh() {
        clearToast();
        setTimeout(function(){
            $("#js-grid-function-full").jsGrid("refresh");
        },100);
    }

    // 解决js-grid分页不显示
    function jsGridReportRefresh() {
        clearToast();
        setTimeout(function(){
            $("#js-grid-report").jsGrid("refresh");
        },100);
    }

    /*打开问题单*/
    function openFuncProblemModal(type) {
        problemModal.edit = type;
        $('#funcProblemModal').modal('show');
    }

    /*设置问题单*/
    function setFuncProblemModal (id) {
        $.ajax({
            type: "post",
            url: "/problem/getByProblemId?problemId=" + id,
            contentType: "application/json",
            dataType: "json",
            success: function(result){
                if(result.code == 0){
                    problemModal.funcName = result.data.pbm.funcName;
                    problemModal.testCaseId = result.data.pbm.testCaseId;
                    problemModal.errorType = setErrorType(result.data.pbm.errorType);
                    problemModal.errorLevel = result.data.pbm.errorLevel;
                    problemModal.environment = result.data.pbm.testEnvironment;
                    problemModal.testCaseName = result.data.pbm.testCaseName;
                    problemModal.testInput = result.data.pbm.testInput;
                    problemModal.problemDesc = result.data.pbm.problemDescription;
                    problemModal.suggest = result.data.pbm.suggest;
                    problemModal.solution = result.data.pbm.solution;
                    problemModal.result = result.data.pbm.closedCycleResult;
                    problemModal.testPerson = result.data.pbm.testPerson;
                    problemModal.testTime = result.data.pbm.testTime;
                    problemModal.remark = result.data.pbm.remark;
                    if (result.data.pbm.other != null) {
                        problemModal.other = JSON.parse(result.data.pbm.other);
                    }
                    problemModal.procedureId = result.data.pbm.procedureId;
                }
            }
        });
    }

    /*删除问题单*/
    function deleteFuncProblemModal (id, functionName) {
        $.ajax({
            type: "post",
            url: "/problem/deleteProblemById?problemId=" + id + "&functionName=" + functionName + "&projectName=" + projectName + "&projectVersion=" + projectVersion,
            contentType: "application/json",
            dataType: "json",
            success: function(result){
                if(result.code == 0){
                    $.showSuccessToast("删除问题单成功.");
                    for(var i=0; i<projectFunctionVue.problemList.length; i++){
                        if(projectFunctionVue.problemList[i].id == id){
                            projectFunctionVue.problemList.splice(i,1);
                        }
                    }
                    if(projectFunctionVue.problemList.length > 0){
                        projectFunctionVue.problemTbSelectId = projectFunctionVue.problemList[0].id
                    }else{
                        projectFunctionVue.problemTbSelectId = 0;
                    }
                    refreshList();
                }
            }
        });
    }

    /*清空问题单*/
    function resetFuncProblemModal() {
        $.ajax({
            type: "GET",
            url: "/problemProperty/getAll",
            success: function(result){
                problemModal.funcName = functionItem.longName;
                problemModal.errorType = [];
                problemModal.errorLevel = 0;
                problemModal.environment = "";
                if(projectFunctionVue.tcfList.length > 0){
                    problemModal.testCaseName = projectFunctionVue.tcfList[0].fileName;
                    // problemModal.testCaseId = projectFunctionVue.tcfList[0].num;
                }else{
                    problemModal.testCaseName = "";
                    problemModal.testCaseId = "";
                }
                problemModal.testInput = "";
                problemModal.problemDesc = "";
                problemModal.suggest = "";
                problemModal.solution = "";
                problemModal.result = "";
                problemModal.testPerson = "";
                problemModal.testTime = "";
                problemModal.remark = "";
                problemModal.other = result;
                problemModal.procedureId = "";

                $.ajax({
                    type: "POST",
                    url: "/function/isOverloadedFun?longName=" + functionItem.longName + "&project=" + [[${project}]] + "&version=" + [[${version}]],
                    contentType: "application/json",
                    dataType: "json",
                    success: function (res){
                        if(res.code == 0 && res.data.isOverloaded == true){
                            problemModal.funcName = functionItem.fullName.replace("(","_").replace(")","").replace(",","_");
                        }
                    }
                });
            }
        });
    }

    /*设置问题单错误类型*/
    function setErrorType(errorType) {
        var array = [];
        var s1 = ""+errorType;
        for (var i = 0; i < s1.length; i++) {
            array.push(s1[i]);
        }
        return array;
    }

    /*获取问题单错误类型*/
    function getErrorType() {
        var sum = "";
        console.log(problemModal.errorType);
        for (var i = 0; i < problemModal.errorType.length; i++) {
            sum = sum + problemModal.errorType[i];
        }
        sum = parseInt(sum);
        return sum;
    }

    /*获取问题单数据*/
    function getFuncProblemModal() {
        var errorType = getErrorType();
        // var procedureId = functionItem.id;
        console.log("errorType: "+ typeof errorType+"  "+errorType);
        // console.log("procedureId: "+procedureId);
        console.log("projectId: "+projectId);
        console.log("projectVersion: "+projectVersion);
        // if(problemModal.testCaseId == ""){
        //     $.showWarningToast("请输入用例标识.");
        //     return false;
        // }
        if(problemModal.errorType.length == 0){
            $.showWarningToast("请输入错误类型.");
            return false;
        }
        if(problemModal.errorLevel < 1){
            $.showWarningToast("请输入问题级别.");
            return false;
        }
        if(problemModal.environment == ""){
            $.showWarningToast("请输入测试环境.");
            return false;
        }
        if(problemModal.environment.length >= 245){
            $.showWarningToast("测试环境不能超过245个字符.");
            return false;
        }
        // if(problemModal.testCaseName == ""){
        //     $.showWarningToast("请输入用例文件名.")
        // }
        if(problemModal.testInput == ""){
            $.showWarningToast("请输入测试输入.");
            return false;
        }
        if(problemModal.testInput.length >= 2245){
            $.showWarningToast("测试输入不能超过2245个字符.");
            return false;
        }
        if(problemModal.problemDesc == ""){
            $.showWarningToast("请输入问题描述.");
            return false;
        }
        if(problemModal.problemDesc.length >= 2245){
            $.showWarningToast("问题描述不能超过2245个字符.");
            return false;
        }
        if(problemModal.suggest == ""){
            $.showWarningToast("请输入开发人员意见.");
            return false;
        }
        if(problemModal.suggest.length >= 2245){
            $.showWarningToast("开发人员意见不能超过2245个字符.");
            return false;
        }
        if(problemModal.solution == ""){
            $.showWarningToast("请输入解决方案.");
            return false;
        }
        if(problemModal.solution.length >= 2245){
            $.showWarningToast("解决方案不能超过2245个字符.");
            return false;
        }
        if(problemModal.result == ""){
            $.showWarningToast("请输入闭环结果.");
            return false;
        }
        if(problemModal.result.length >= 2245){
            $.showWarningToast("闭环结果不能超过2245个字符.");
            return false;
        }
        if(problemModal.testPerson == ""){
            $.showWarningToast("请输入测试人.");
            return false;
        }
        if(problemModal.testPerson.length >= 45){
            $.showWarningToast("测试人名称不能超过45个字符.");
            return false;
        }
        if(problemModal.testTime == ""){
            $.showWarningToast("请输入测试时间.");
            return false;
        }
        if(problemModal.remark.length >= 2245){
            $.showWarningToast("备注长度不能超过2245个字符.");
            return false;
        }
        var othetCount = 0;
        for(var i=0; i<problemModal.other.length; i++){
            othetCount += problemModal.other[i].value.length;
        }
        if(othetCount >= 5000){
            $.showWarningToast("动态属性所有名称加起来长度不能超过5000个字符.");
            return false;
        }

        var json = {funcName: problemModal.funcName, testCaseId: problemModal.testCaseId,
            errorType: errorType, errorLevel: problemModal.errorLevel, testEnvironment: problemModal.environment,
            testCaseName: problemModal.testCaseName, testInput: problemModal.testInput, problemDescription: problemModal.problemDesc,
            suggest: problemModal.suggest, solution: problemModal.solution, closedCycleResult: problemModal.result ,
            testPerson: problemModal.testPerson, testTime: problemModal.testTime, remark: problemModal.remark,
            other: JSON.stringify(problemModal.other), projectId: projectId, projectVersion: projectVersion};
        return json;
    }

    /*问题单数据提交*/
    function submit() {
        var data = getFuncProblemModal();
        if(data == false){
            return;
        }
        if (problemOrdertype === "add") {
            data.procedureId = functionItem.id;
            $.ajax({
                type: "post",
                url: "/problem/addProblem?projectName=" + projectName + "&projectVersion=" + projectVersion,
                data: JSON.stringify(data),
                contentType: "application/json",
                dataType: "json",
                success: function(result){
                    if (result.code == 0) {
                        $.showSuccessToast("新增成功");
                        $('#funcProblemModal').modal('hide');
                        refreshList();
                    } else {
                        // window.alert("新增失败");
                        $('#funcProblemModal').modal('hide');
                    }
                }
            });
        }
        if (problemOrdertype === "modify") {
            data.id = problemId;
            data.procedureId = functionItem.id;
            // console.log("modify: "+JSON.stringify(data));
            $.ajax({
                type: "post",
                url: "/problem/updateProblem?projectName=" + projectName + "&projectVersion=" + projectVersion,
                data: JSON.stringify(data),
                contentType: "application/json",
                dataType: "json",
                success: function(result){
                    if (result.code == 0) {
                        $.showSuccessToast("修改成功");
                        $('#funcProblemModal').modal('hide');
                        refreshList();
                    } else {
                        // window.alert("修改失败");
                        $('#funcProblemModal').modal('hide');
                    }
                }
            });
        }
        if (problemOrdertype === "modify2") {
            data.id = problemId;
            data.procedureId = problemModal.procedureId;
            // console.log("modify: "+JSON.stringify(data));
            $.ajax({
                type: "post",
                url: "/problem/updateProblem?projectName=" + projectName + "&projectVersion=" + projectVersion,
                data: JSON.stringify(data),
                contentType: "application/json",
                dataType: "json",
                success: function(result){
                    if (result.code == 0) {
                        $.showSuccessToast("修改成功");
                        $('#funcProblemModal').modal('hide');
                        $("#js-grid-problem").jsGrid("render");
                    } else {
                        // window.alert("修改失败");
                        $('#funcProblemModal').modal('hide');
                    }
                }
            });
        }
    }

    /*退出问题单*/
    function cancel() {
        $('#funcProblemModal').modal('hide');
    }

    /*refresh*/
    function refreshList () {
        $.ajax({
            type: "post",
            url: "/problem/getByProcedureIdAndProjectAndVersion?procedureId=" + functionItem.id + "&project=" + [[${project}]] + "&version=" + [[${version}]],
            contentType: "application/json",
            dataType: "json",
            success: function(result){
                if(result.code == 0){
                    projectFunctionVue.problemList = result.data.list;
                    if(result.data.list.length > 0){
                        projectFunctionVue.problemTbSelectId = result.data.list[0].id;
                    }else if(result.data.list.length == 0){
                        projectFunctionVue.problemTbSelectId = 0;
                    }
                }
            }
        });
        $("#js-grid-problem").jsGrid("render");
    }

    function produceReport(event) {
        // button绑定了默认事件，须取消掉
        event.preventDefault();//阻止默认事件
        event.stopPropagation();//阻止冒泡
        // var data = {
        //     reportName: $('#reportName').val(),
        //     reportDesc: $('#reportDesc').val()
        // };
        // if(data.reportName == ""){
        //     alert("请输入报告名称");
        //     return false;
        // }
        var data = {
            reportName: "",
            reportDesc: ""
        };
        var fileType = $("#selector_fileType").val();
        if(fileType === "1"){
            var muban = $("#wordmuban").text();
            if(muban === "" || muban === "模板未上传"){
                $.showWarningToast("请先上传word模板.");
                return;
            }
        }else if(fileType === "2"){
            var muban = $("#explainmuban").text();
            if(muban === ""|| muban === "模板未上传"){
                $.showWarningToast("请先上传word模板.");
                return;
            }
        }
        $("#reportCircle").css("display", "inline-block");
        $("#reportBtn").attr('disabled',true);
        $.ajax({
            type: "post",
            url: "/report/produce?project=" + [[${project}]] + "&version=" + [[${version}]] + "&fileType="+fileType + "&projectName=" + projectName + "&sure=1",
            contentType: "application/json",
            dataType: "json",
            data: JSON.stringify(data),
            success: function(result){
                if(result.code == 0){
                    if(result.data.data == "2"){
                        swal("你确认要生成报告吗?", {
                            buttons: ["取消", "确认"]
                        }).then(function(res){
                            if(res){
                                $.ajax({
                                    type: "post",
                                    url: "/report/produce?project=" + [[${project}]] + "&version=" + [[${version}]] + "&fileType="+fileType + "&projectName=" + projectName + "&sure=2",
                                    contentType: "application/json",
                                    dataType: "json",
                                    data: JSON.stringify(data),
                                    success: function(result){
                                        if(result.code == 0){
                                            // $.showSuccessToast("", "生成报告成功.");
                                            $("#js-grid-report").jsGrid("render");
                                            $.showSuccessToast("生成报告任务添加成功.请稍后几分钟再查看结果.");
                                        }
                                    }
                                });
                            }
                        });
                    }
                }
                $("#reportCircle").css("display", "none");
                $("#reportBtn").attr('disabled',false);
            },
            error: function(data){

            }
        });
        return false;
    }
    function refreshReport(event){
        event.preventDefault();//阻止默认事件
        event.stopPropagation();//阻止冒泡
        $("#js-grid-report").jsGrid("render");
    }
    function getWordmuban(fileType) {
        $.ajax({
            type: "post",
            url: "/proVerWordmubanList?project=" + [[${project}]] + "&version=" + [[${version}]] + "&fileType=" + fileType,
            contentType: "application/json",
            dataType: "json",
            success: function(result){
                if(fileType == 1){
                    for(var i=0; i<result.length; i++){
                        $("#wordmuban").html(result[i].fileName);
                        $("#wordmuban").css("color","green");
                        $("#wordmuban").attr("href", "/file-upload/downloadUp?fileName="+ encodeURIComponent(result[i].fileUrl) + "&reportName=" + result[i].fileName);
                        break;
                    }
                }else if(fileType == 2){
                    for(var i=0; i<result.length; i++){
                        $("#explainmuban").html(result[i].fileName);
                        $("#explainmuban").css("color","green");
                        $("#explainmuban").attr("href", "/file-upload/downloadUp?fileName="+ encodeURIComponent(result[i].fileUrl) + "&reportName=" + result[i].fileName);
                        break;
                    }
                }
            },
            error: function(data){

            }
        });
    }

    $(document).ready(function () {

        var sigenalUploadVue = new Vue({
            el: '#sigenal-upload-card',
            data: {
                fileType: 1,
                fileTypeList: [
                    {value: 1, label: 'TCF文件'},
                    {value: 2, label: '覆盖率文件'},
                    {value: 3, label: '截图文件'}
                ],
                pictureType: 1,
                pictureTypeList: [
                    {value: 1, label: '测试路径'},
                    {value: 2, label: '语句覆盖率'},
                    {value: 3, label: '分支覆盖率'}
                ],
                functionDropzone: null,
                analysisIngS: false,
                analysisCompleteS: false,
                progressValue: 0
            },
            computed: {
                progressValuePercent: function () {
                    return "width: "+this.progressValue+"%";
                },
                progressValueText: function () {
                    return this.progressValue+"%";
                },
                getFileType: function() {
                    if(this.fileType === 1){
                        return '.tcf'
                    }else if(this.fileType === 2){
                        return '.htm, .html'
                    }else if(this.fileType === 3){
                        return ".jpg, .jpeg, .png"
                    }
                }
            },
            methods: {
                onChange: function() {
                    // Dropzone.autoDiscover = false;
                    if(this.functionDropzone){
                        this.functionDropzone.destroy();
                        this.analysisIngS = false;
                        this.analysisCompleteS = false;
                        this.progressValue = 0;
                    }
                    var that = this;
                    this.functionDropzone = new Dropzone("#sigenal-dropzone", {
                        url: "/file-upload/single?project=" + projectId + "&version=" + projectVersion +
                        "&fullName="+functionItem.fullName+"&hashValue="+functionItem.hashValue +
                        "&fileType=" + that.fileType + "&pictureType=" + that.pictureType,
                        // uploadMultiple: false,
                        method: "post",  //也可用put
                        paramName: "file", //默认为file
                        maxFiles: 1,//一次性上传的文件数量上限
                        maxFilesize: 200, //MB
                        acceptedFiles: that.getFileType, //上传的类型
                        timeout: 180000,
                        // previewsContainer: "#adds", //显示的容器
                        parallelUploads: 10,
                        uploadMultiple: true,
                        dictDefaultMessage: '拖动文件至此或者点击上传', // 设置默认的提示语句
                        dictMaxFilesExceeded: "您最多只能上传1个文件！",
                        dictResponseError: '文件上传失败!',
                        dictInvalidFileType: "你不能上传该类型文件,文件类型只能是"+that.getFileType,
                        dictFallbackMessage: "浏览器不受支持",
                        dictFileTooBig: "文件过大上传文件最大支持.",
                        // previewTemplate: document.querySelector("#preview-template").innerHTML,//设置显示模板
                        previewTemplate: "<div class=\"dz-preview dz-file-preview\" style='display: inline-block'>\n  <div class=\"dz-image\"><img data-dz-thumbnail /></div>\n  <div class=\"dz-details\">\n    <div class=\"dz-size\"><span data-dz-size></span></div>\n    <div class=\"dz-filename\"><span data-dz-name></span></div>\n  </div>\n  <div class=\"dz-progress\"><span class=\"dz-upload\" data-dz-uploadprogress></span></div>\n  <div class=\"dz-error-message\"><span data-dz-errormessage></span></div>\n  <div class=\"dz-success-mark\">\n    <svg width=\"54px\" height=\"54px\" viewBox=\"0 0 54 54\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:sketch=\"http://www.bohemiancoding.com/sketch/ns\">\n      <title>Check</title>\n      <defs></defs>\n      <g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\" sketch:type=\"MSPage\">\n        <path d=\"M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\" id=\"Oval-2\" stroke-opacity=\"0.198794158\" stroke=\"#747474\" fill-opacity=\"0.816519475\" fill=\"#FFFFFF\" sketch:type=\"MSShapeGroup\"></path>\n      </g>\n    </svg>\n  </div>\n  <div class=\"dz-error-mark\">\n    <svg width=\"54px\" height=\"54px\" viewBox=\"0 0 54 54\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:sketch=\"http://www.bohemiancoding.com/sketch/ns\">\n      <title>Error</title>\n      <defs></defs>\n      <g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\" sketch:type=\"MSPage\">\n        <g id=\"Check-+-Oval-2\" sketch:type=\"MSLayerGroup\" stroke=\"#747474\" stroke-opacity=\"0.198794158\" fill=\"#FFFFFF\" fill-opacity=\"0.816519475\">\n          <path d=\"M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\" id=\"Oval-2\" sketch:type=\"MSShapeGroup\"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>",
                        init: function () {
                            this.on("addedfile", function (file) {
                                that.analysisIngS = true;
                                that.analysisCompleteS = false;
                                that.progressValue = 0;
                                // //上传文件时触发的事件
                                // $("input[type='file']").each(function(i){
                                //     $(this).attr("disabled", true);
                                // });
                            });
                            this.on("queuecomplete", function (file) {
                                //上传队列中的所有文件完成后触发的方法
                                // $(".dz-hidden-input").attr("disabled",false);
                                that.analysisIngS = false;
                                that.analysisCompleteS = true;
                                // $("#js-grid-static-main").jsGrid("render");
                            });
                            this.on('totaluploadprogress', function (progress, byte, bytes) {
                                //用 uploadProgress (0-100), totalBytes 和 totalBytesSent的总数调用. 此事件可以用于显示所有文件的总体上传进度.
                                //console.log(parseInt(progress));
                                that.progressValue = parseInt(progress);
                                // $("input[type='file']").each(function(i){
                                //     $(this).attr("disabled", true);
                                // });
                            });
                            this.on("removedfile", function (file) {
                                //删除文件时触发的方法
                            });
                            this.on("success", function (file,result) {
                                //文件已经成功上传，获得服务器返回信息作为第二个参数(这个时间又被称作finished)
                                if(result.code == 16){
                                    $.showDangerToast(result.msg);
                                    that.onChange();
                                }
                            });
                        }
                    });
                }
            }
        });
        $('#uploadModal').on('shown.bs.modal', function (e) {
            sigenalUploadVue.onChange();
        });
        $('#uploadModal').on('hidden.bs.modal', function () {
            sigenalUploadVue.functionDropzone.destroy();
            $("#js-grid-function").jsGrid("rowClick", jsGridFunctionItem);
            $("#js-grid-coverage").jsGrid("render");
            $("#js-grid-tcf").jsGrid("render");
            $("#js-grid-picture").jsGrid("render");
        });

        var funcStatisticVue = new Vue({
            el: '#func-statistic',
            data: {
                all: 0,
                old: 0,
                modify: 0,
                add: 0
            }
        });
        var funcSearchVue = new Vue({
            el: '#func-search-vue',
            data: {
                optionProblem: false,
                optionTcf: false,
                optionCoverage: false,
                optionPicture: false,
                type: -1
            },
            methods: {
                search: function(event) {
                    event.preventDefault();//阻止默认事件
                    event.stopPropagation();//阻止冒泡
                    $("#js-grid-function-full").jsGrid("search").done(function() {

                    });
                }
            }
        });
        projectFunctionVue = new Vue({
            el: '#project-function-vue',
            data: {
                problemTbSelectId: 0,
                screenShotTbSelectId: 1,
                screenShotMode: false,
                notHaveSure: false,
                haveSure: false,
                name: "",
                comment: "",
                hashValue: "",
                returnType: "",
                createTime: "",
                updateTime: "",
                fullName: "",
                paramInComment: "",
                paramOutComment: "",
                param: [
                    // { name: "input1", cls: "Integer", type: "in" , val: ""},
                    // { name: "input2", cls: "Integer", type: "out" , val: ""},
                    // { name: "input3", cls: "Integer", type: "inout" , val: ""}
                ],
                globalVarCpmment: "",
                globalVar: [
                    // { name: "input1", cls: "Integer", val: ""},
                    // { name: "input2", cls: "Integer", val: ""},
                    // { name: "input3", cls: "Integer", val: ""}
                ],
                problemList: [],
                coverageList: [],
                tcfList: [],
                screenShotList: []
            },
            methods: {
                formatDate: function(item) {
                    var date = new Date(item);
                    return date.Format("yyyy-MM-dd");
                },
                problemTbSelected: function (id) {
                    if(id == this.problemTbSelectId) {
                        return "grid-select-my";
                    }else{
                        return "";
                    }
                },
                problemTbRowClick: function (id) {
                    this.problemTbSelectId = id;
                },
                screenShotTbSelected: function (id) {
                    if(id == this.screenShotTbSelectId) {
                        return "grid-select-my";
                    }else{
                        return "";
                    }
                },
                screenShotTbRowClick: function (id) {
                    this.screenShotTbSelectId = id;
                }
            }
        });
        // console.log(projectFunctionVue);

        projectId = [[${project}]];
        projectVersion = [[${version}]];
        projectName = [[${projectName}]];

        var screenShotModal = new Vue({
            el: '#screenShotModal',
            data: {
                type: 1,
                src: "../../../../images/faces/face1.jpg"
            }
        });

        var functionElements = document.getElementById('funcChart');
        var functionChartSelf = echarts.init(functionElements);
        functionChartSelf.setOption(loadFunc(funcRelationData));

        $(".nav-link").on("click", function(e){
            // loadFunc()
        });

        $.contextMenu({
            selector: '#functionName',
            callback: function (key, options) {
                if (key == "modify") {
                    $("#functionDesc").css("display", "none");
                    $("#functionNameEdit").css("display", "block");
                } else {
                    $("#functionDesc").css("display", "block");
                    $("#functionNameEdit").css("display", "none");
                }
            },
            items: {
                "modify": {
                    name: "修改描述",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-arrange-send-backward';
                    }
                },
                "sep1": "---------",
                "quit": {
                    name: "退出",
                    icon: function () {
                        return 'context-menu-icon context-menu-icon-quit';
                    }
                }
            }
        });

        $("#functionNameEdit").on("keypress", function (e) {
            $("#functionDesc").text($("#functionNameEdit").val());
            $("#functionDesc").css("display", "block");
            $("#functionNameEdit").css("display", "none");
        });

        if ($("#js-grid-function").length) {
            functionGrid = $("#js-grid-function").jsGrid({
                height: "800px",
                width: "100%",
                filtering: true,
                // editing: true,
                //inserting: true,
                sorting: true,
                paging: true,
                autoload: true,
                pageSize: 20,
                pageButtonCount: 5,
                deleteConfirm: "你确定要删除当前项吗?",
                pagerFormat: "{first} {prev} {pages} {next} {last}",
                pagePrevText: "上一页",
                pageNextText: "下一页",
                pageFirstText: "首页",
                pageLastText: "尾页",
                pageLoading: true,
                //data: db.userinfo,
                controller: {
                    loadData: function (filter) {
                        return $.ajax({
                            type: "post",
                            url: "/function/getProVerFuc?project=" + [[${project}]] + "&version=" + [[${version}]],
                            data: JSON.stringify(filter),
                            contentType: "application/json",
                            dataType: "json",
                            async: false
                        });
                    }
                },
                fields: [
                    {
                        title: "标识",
                        name: "id",
                        type: "number",
                        width: 50,
                        visible: false
                    },
                    {
                        title: "函数名",
                        name: "name",
                        type: "text",
                        align: "center",
                        width: 60,
                        visible: true,
                        itemTemplate: function (value, item) {
                            //return $("<a href='#'>").append(value)
                            return $("<div style='word-wrap:break-word'>").append(value);
                        }
                    },
                    {
                        title: "包名.函数名",
                        name: "longName",
                        type: "text",
                        align: "center",
                        width: 107,
                        //visible: false
                        itemTemplate: function (value, item) {
                            //return $("<a href='#'>").append(value)
                            return $("<div style='word-wrap:break-word'>").append(value);
                        }
                    },
                    {
                        title: "全名",
                        name: "fullName",
                        type: "text",
                        align: "center",
                        width: 100,
                        visible: false,
                        itemTemplate: function(value, item){
                            var result;
                            var className = "badge-info";
                            if(item){
                                if (item.insertFlag == 2) {
                                    className = "badge-warning"
                                }
                                else if (item.insertFlag == 1) {
                                    className = "badge-danger"
                                }
                                else if(item.insertFlag == 0) {
                                    className = "badge-info"
                                }
                                for(var i=0; i<modifyList.length; i++){
                                    if(modifyList[i].Id == value) {
                                        result = modifyList[i].Name;
                                    }
                                }
                            }
                            return $("<div>").addClass("badge").addClass(className).append(value);
                        }
                    },
                    // {
                    //     title: "验证码",
                    //     name: "hashValue",
                    //     type: "text",
                    //     align: "center",
                    //     width: 100
                    // },
                    {
                        title: "版本",
                        name: "version",
                        type: "text",
                        align: "center",
                        width: 30
                    },
                    {
                        title: "代码行数",
                        name: "lineCount",
                        type: "text",
                        align: "center",
                        width: 37
                    },
                    {
                        title: "修改描述",
                        name: "insertFlag",
                        type: "select",
                        align: "center",
                        items: modifyList,
                        valueField: "Id",
                        textField: "Name",
                        width: 37,
                        itemTemplate: function (value, item) {
                            //<div class="badge badge-info">Info</div>
                            var result;
                            var className = "badge-info";
                            if(item){
                                if (item.insertFlag == 2) {
                                    className = "badge-warning"
                                }
                                else if (item.insertFlag == 1) {
                                    className = "badge-danger"
                                }
                                else if(item.insertFlag == 0) {
                                    className = "badge-info"
                                }
                                for(var i=0; i<modifyList.length; i++){
                                    if(modifyList[i].Id == value) {
                                        result = modifyList[i].Name;
                                    }
                                }
                            }
                            return $("<div>").addClass("badge").addClass(className).append(result);
                        }
                    },
                    {
                        title: "确认状态",
                        name: "affirm",
                        type: "select",
                        align: "center",
                        items: affirmList,
                        valueField: "Id",
                        textField: "Name",
                        width: 37,
                        itemTemplate: function (value, item) {
                            //<div class="badge badge-info">Info</div>
                            var result;
                            var className = "badge-info";
                            if(item){
                                if (item.descComment != '') {
                                    className = "badge-success";
                                    result = '已确认';
                                } else if(item.descComment == '') {
                                    className = "badge-danger";
                                    result = '未确认';
                                }
                            }
                            return $("<div>").addClass("badge").addClass(className).append(result);
                        }
                    },
                    // {
                    //     title: "性能",
                    //     name: "Performance",
                    //     type: "text",
                    //     align: "center",
                    //     width: 70
                    // },
                    // {
                    //     title: "特性",
                    //     name: "Feature",
                    //     type: "text",
                    //     align: "center",
                    //     width: 70
                    // },
                    // {
                    //     title: "编写人",
                    //     name: "Creator",
                    //     type: "select",
                    //     items: db.userinfo,
                    //     valueField: "Id",
                    //     textField: "Name",
                    //     align: "center",
                    //     width: 70
                    // },
                    {
                        title: "返回值类型",
                        name: "returnType",
                        type: "text",
                        align: "center",
                        width: 70,
                        visible: false
                    },
                    {
                        title: "录入日期",
                        name: "createTime",
                        type: "text",
                        align: "center",
                        width: 70,
                        visible: false
                    },
                    {
                        title: "更新日期",
                        name: "updateTime",
                        type: "text",
                        align: "center",
                        width: 70,
                        visible: false
                    }
                ],
                onDataLoaded: function(args) {
                    // $("#js-grid-function .jsgrid-grid-body tbody tr:first").trigger("click");
                    // if(args){
                    //     if(args.data){
                    //         if(args.data.data){
                    //             funcStatisticVue.all = 0;
                    //             funcStatisticVue.old = 0;
                    //             funcStatisticVue.modify = 0;
                    //             funcStatisticVue.add = 0;
                    //             for(var i=0; i<args.data.data.length; i++){
                    //                 funcStatisticVue.all++;
                    //                 if(args.data.data[i].insertFlag == 0){
                    //                     funcStatisticVue.old++;
                    //                 } else if(args.data.data[i].insertFlag == 1){
                    //                     funcStatisticVue.modify++;
                    //                 } else if(args.data.data[i].insertFlag == 2){
                    //                     funcStatisticVue.add++;
                    //                 }
                    //             }
                    //         }
                    //     }
                    // }
                },
                onPageChanged: function(args) {
                    setTimeout(function () {
                        funcGridClick();
                    }, 1000);
                },
                rowClass: function (item, itemIndex) {
                    if(functionItem){
                        if(item.id == functionItem.id){
                            return "grid-select-my";
                        }
                    }
                },
                rowClick: function (item, itemIndex) {
                    clearToast();
                    jsGridFunctionItem = item;
                    functionItem = item.item;

                    functionName = item.item.longName;

                    projectFunctionVue.hashValue = functionItem.hashValue;
                    projectFunctionVue.returnType = functionItem.returnType;
                    if(functionItem.createTime && functionItem.createTime.length>=10){
                        projectFunctionVue.createTime = functionItem.createTime.substr(0,10);
                    }
                    if(functionItem.updateTime && functionItem.updateTime.length>=10){
                        projectFunctionVue.updateTime = functionItem.updateTime.substr(0,10);
                    }
                    projectFunctionVue.fullName = functionItem.fullName
                    $.ajax({
                        type: "post",
                        url: "/fundesc/selectByProcedureId?procedureId=" + functionItem.id,
                        contentType: "application/json",
                        dataType: "json",
                        success: function(result){
                            if(result.code == 0){
                                if(result.data.list.length == 0){
                                    projectFunctionVue.name = "";
                                    projectFunctionVue.comment = "";
                                    projectFunctionVue.globalVarCpmment = "";
                                    projectFunctionVue.paramInComment = "";
                                    projectFunctionVue.paramOutComment = "";
                                }else if(result.data.list.length > 0){
                                    projectFunctionVue.name = result.data.list[0].name;
                                    projectFunctionVue.comment = result.data.list[0].comment;
                                    projectFunctionVue.globalVarCpmment = result.data.list[0].varDescription;
                                    projectFunctionVue.paramInComment = result.data.list[0].inputDescription;
                                    projectFunctionVue.paramOutComment = result.data.list[0].outputDescription;
                                    if(projectFunctionVue.comment === ""){
                                        projectFunctionVue.haveSure = false;
                                        projectFunctionVue.notHaveSure = true;
                                    }else{
                                        projectFunctionVue.haveSure = true;
                                        projectFunctionVue.notHaveSure = false;
                                    }
                                }
                            }
                        },
                        error: function(data){

                        }
                    });
                    $.ajax({
                        type: "post",
                        url: "/function/findProcedureParamByProcedureId?procedureId=" + functionItem.id,
                        contentType: "application/json",
                        dataType: "json",
                        success: function(result){
                            if(result.code == 0){
                                projectFunctionVue.param = result.data.list;
                            }
                        }
                    });
                    $.ajax({
                        type: "post",
                        url: "/function/findProcedureVarByProcedureId?procedureId=" + functionItem.id,
                        contentType: "application/json",
                        dataType: "json",
                        success: function(result){
                            if(result.code == 0){
                                projectFunctionVue.globalVar = result.data.list;
                            }
                        }
                    });

                    $.ajax({
                        type: "POST",
                        url: "/function/isOverloadedFun?longName=" + functionItem.longName + "&project=" + [[${project}]] + "&version=" + [[${version}]],
                        contentType: "application/json",
                        dataType: "json",
                        success: function (res){
                            var longName = functionItem.longName;
                            if(res.code == 0 && res.data.isOverloaded == true){
                                longName = functionItem.fullName.replace("(","_").replace(")","").replace(",","_");
                            }
                            $.ajax({
                                type: "post",
                                url: "/function/findCoverageFileByProcedureFullName?functionName=" + longName + "&project=" + [[${project}]] + "&version=" + [[${version}]] + "&hashValue=" + functionItem.hashValue,
                                contentType: "application/json",
                                dataType: "json",
                                success: function(result){
                                    if(result.code == 0){
                                        for(var i=0; i<result.data.list.length; i++){
                                            result.data.list[i].href = "/file-upload/downloadUp?fileName="+ encodeURIComponent(result.data.list[i].fileUrl) + "&reportName=" + result.data.list[i].fileName;
                                            if(result.data.list[i].branchCoverage === ""){
                                                result.data.list[i].branchCoverageShow = "\\";
                                            }else{
                                                result.data.list[i].branchCoverageShow = result.data.list[i].branchCoverage;
                                            }
                                        }
                                        projectFunctionVue.coverageList = result.data.list;
                                    }
                                }
                            });
                            $.ajax({
                                type: "post",
                                url: "/function/findTcfFileByProcedureFullName?functionName=" + longName + "&project=" + [[${project}]] + "&version=" + [[${version}]] + "&hashValue=" + functionItem.hashValue,
                                contentType: "application/json",
                                dataType: "json",
                                success: function(result){
                                    if(result.code == 0){
                                        for(var i=0; i<result.data.list.length; i++){
                                            result.data.list[i].href = "/file-upload/downloadUp?fileName="+ encodeURIComponent(result.data.list[i].fileUrl) + "&reportName=" + result.data.list[i].fileName;
                                        }
                                        projectFunctionVue.tcfList = result.data.list;
                                    }
                                }
                            });
                            $.ajax({
                                type: "post",
                                url: "/function/findPictureFileByProcedureFullName?functionName=" + longName + "&project=" + [[${project}]] + "&version=" + [[${version}]] + "&hashValue=" + functionItem.hashValue,
                                contentType: "application/json",
                                dataType: "json",
                                success: function(result){
                                    if(result.code == 0) {
                                        for (var i = 0; i < result.data.list.length; i++) {
                                            result.data.list[i].href = "/file-upload/downloadUp?fileName=" + encodeURIComponent(result.data.list[i].fileUrl) + "&reportName=" + result.data.list[i].fileName;
                                            if (result.data.list[i].fileType === 1) {
                                                result.data.list[i].pictureType = "测试路径";
                                                result.data.list[i].pictureTypeClass = "badge-warning";
                                            } else if (result.data.list[i].fileType === 2) {
                                                result.data.list[i].pictureType = "语句覆盖率";
                                                result.data.list[i].pictureTypeClass = "badge-danger";
                                            } else if (result.data.list[i].fileType === 3) {
                                                result.data.list[i].pictureType = "分支覆盖率";
                                                result.data.list[i].pictureTypeClass = "badge-info";
                                            }
                                        }
                                        projectFunctionVue.screenShotList = result.data.list;
                                    }
                                }
                            });
                        }
                    });
                    $.ajax({
                        type: "post",
                        url: "/problem/getByProcedureIdAndProjectAndVersion?procedureId=" + functionItem.id + "&project=" + [[${project}]] + "&version=" + [[${version}]],
                        contentType: "application/json",
                        dataType: "json",
                        success: function(result){
                            if(result.code == 0){
                                projectFunctionVue.problemList = result.data.list;
                                if(result.data.list.length > 0){
                                    projectFunctionVue.problemTbSelectId = result.data.list[0].id;
                                }else if(result.data.list.length == 0){
                                    projectFunctionVue.problemTbSelectId = 0;
                                }
                            }
                        }
                    });

                    $.ajax({
                        type: "post",
                        url: "/function/getProVerProcedureCall?procedureId=" + functionItem.id + "&project=" + [[${project}]] + "&version=" + [[${version}]],
                        success: function(result){
                            if(result.self){
                                funcRelationData = result;
                                functionChartSelf.dispose();
                                try{
                                    functionChartSelf = echarts.init(functionElements);
                                    functionChartSelf.setOption(loadFunc(funcRelationData));
                                }catch( e){

                                }
                            }
                        }
                    });
                }
            });
            $.ajax({
                type: "post",
                url: "/function/getProVerFucCount?project=" + [[${project}]] + "&version=" + [[${version}]],
                contentType: "application/json",
                dataType: "json",
                success: function(result){
                    if(result.code == 0){
                        if(result.data){
                            funcStatisticVue.all = result.data.all;
                            funcStatisticVue.old = result.data.old;
                            funcStatisticVue.modify = result.data.modify;
                            funcStatisticVue.add = result.data.add;
                        }
                    }
                }
            });
        }

        if ($("#js-grid-function-full").length) {
            functionGrid = $("#js-grid-function-full").jsGrid({
                height: "610px",
                width: "100%",
                // filtering: true,
                // editing: true,
                //inserting: true,
                sorting: true,
                paging: true,
                autoload: true,
                pageSize: 20,
                pageButtonCount: 5,
                deleteConfirm: "你确定要删除当前项吗?",
                pagerFormat: "{first} {prev} {pages} {next} {last}",
                pagePrevText: "上一页",
                pageNextText: "下一页",
                pageFirstText: "首页",
                pageLastText: "尾页",
                pageLoading: true,
                //data: db.userinfo,
                controller: {
                    loadData: function (filter) {
                        var option = {
                            problem: funcSearchVue.optionProblem,
                            tcf: funcSearchVue.optionTcf,
                            coverage: funcSearchVue.optionCoverage,
                            picture: funcSearchVue.optionPicture,
                            insertFlag: funcSearchVue.type,
                            pageSize: filter.pageSize,
                            pageIndex: filter.pageIndex
                        };
                        return $.ajax({
                            type: "post",
                            url: "/function/getProVerFucFull?project=" + [[${project}]] + "&version=" + [[${version}]],
                            data: JSON.stringify(option),
                            contentType: "application/json",
                            dataType: "json",
                            async: false
                        });
                    }
                },
                fields: [
                    {
                        title: "标识",
                        name: "id",
                        type: "number",
                        width: 50,
                        visible: false
                    },
                    {
                        title: "函数名",
                        name: "name",
                        type: "text",
                        align: "center",
                        width: 70,
                        visible: true
                    },
                    {
                        title: "包名.函数名",
                        name: "longName",
                        type: "text",
                        align: "center",
                        width: 70,
                        //visible: false
                    },
                    {
                        title: "全名",
                        name: "fullName",
                        type: "text",
                        align: "center",
                        width: 130,
                        visible: true
                        // itemTemplate: function(value, item){
                        //     var result;
                        //     var className = "badge-info";
                        //     if(item){
                        //         if (item.insertFlag == 2) {
                        //             className = "badge-warning"
                        //         }
                        //         else if (item.insertFlag == 1) {
                        //             className = "badge-danger"
                        //         }
                        //         else if(item.insertFlag == 0) {
                        //             className = "badge-info"
                        //         }
                        //         for(var i=0; i<modifyList.length; i++){
                        //             if(modifyList[i].Id == value) {
                        //                 result = modifyList[i].Name;
                        //             }
                        //         }
                        //     }
                        //     return $("<div>").addClass("badge").addClass(className).append(value);
                        // }
                    },
                    {
                        title: "验证码",
                        name: "hashValue",
                        type: "text",
                        align: "center",
                        width: 80
                    },
                    {
                        title: "版本",
                        name: "version",
                        type: "text",
                        align: "center",
                        width: 25
                    },
                    {
                        title: "代码行数",
                        name: "lineCount",
                        type: "text",
                        align: "center",
                        width: 32
                    },
                    // {
                    //     title: "修改描述",
                    //     name: "insertFlag",
                    //     type: "select",
                    //     align: "center",
                    //     items: modifyList,
                    //     valueField: "Id",
                    //     textField: "Name",
                    //     width: 40,
                    //     itemTemplate: function (value, item) {
                    //         //<div class="badge badge-info">Info</div>
                    //         var result;
                    //         var className = "badge-info";
                    //         if(item){
                    //             if (item.insertFlag == 2) {
                    //                 className = "badge-warning"
                    //             }
                    //             else if (item.insertFlag == 1) {
                    //                 className = "badge-danger"
                    //             }
                    //             else if(item.insertFlag == 0) {
                    //                 className = "badge-info"
                    //             }
                    //             for(var i=0; i<modifyList.length; i++){
                    //                 if(modifyList[i].Id == value) {
                    //                     result = modifyList[i].Name;
                    //                 }
                    //             }
                    //         }
                    //         return $("<div>").addClass("badge").addClass(className).append(result);
                    //     }
                    // },
                    // {
                    //     title: "性能",
                    //     name: "Performance",
                    //     type: "text",
                    //     align: "center",
                    //     width: 70
                    // },
                    // {
                    //     title: "特性",
                    //     name: "Feature",
                    //     type: "text",
                    //     align: "center",
                    //     width: 70
                    // },
                    // {
                    //     title: "编写人",
                    //     name: "Creator",
                    //     type: "select",
                    //     items: db.userinfo,
                    //     valueField: "Id",
                    //     textField: "Name",
                    //     align: "center",
                    //     width: 70
                    // },
                    {
                        title: "返回值类型",
                        name: "returnType",
                        type: "text",
                        align: "center",
                        width: 30,
                        visible: true
                    },
                    {
                        title: "录入日期",
                        name: "createTime",
                        type: "text",
                        align: "center",
                        width: 30,
                        visible: true
                    },
                    {
                        title: "更新日期",
                        name: "updateTime",
                        type: "text",
                        align: "center",
                        width: 30,
                        visible: true
                    }
                ],
                onDataLoaded: function(args) {

                },
                onPageChanged: function(args) {
                    setTimeout(function () {
                        funcGridClick();
                    }, 1000);
                },
                rowClass: function (item, itemIndex) {

                },
                rowClick: function (item, itemIndex) {

                }
            });
        }

        $.contextMenu({
            selector: '#js-grid-function',
            callback: function (key, options) {
                if (key == "import"){
                    location.href="/excel/exportGridAll?projectId=" + [[${project}]] + "&version=" + [[${version}]];
                }
            },
            items: {
                "import": {
                    name: "导出",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-chart-bar'
                    }
                },
                "sep1": "---------",
                "quit": {
                    name: "退出",
                    icon: function () {
                        return 'context-menu-icon context-menu-icon-quit';
                    }
                }
            }
        });

        $.contextMenu({
            selector: '#card_comment',
            callback: function (key, options) {
                if(key == "modify") {
                    updateFunComment(projectFunctionVue);
                }else if(key == "search") {
                    showLastFunComment(projectFunctionVue);
                }
            },
            items: {
                "search": {
                    name: "复制同名函数信息",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-application';
                    }
                },
                "modify": {
                    name: "更新并确认",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-arrange-send-backward';
                    }
                },
                "sep1": "---------",
                "quit": {
                    name: "退出",
                    icon: function () {
                        return 'context-menu-icon context-menu-icon-quit';
                    }
                }
            }
        });

        $.contextMenu({
            selector: '#card_var',
            callback: function (key, options) {
                if(key == "modify") {
                    updateFunComment(projectFunctionVue);
                }else if(key == "search") {
                    showLastFunComment(projectFunctionVue);
                }
            },
            items: {
                "search": {
                    name: "复制同名函数信息",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-application';
                    }
                },
                "modify": {
                    name: "更新并确认",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-arrange-send-backward';
                    }
                },
                "sep1": "---------",
                "quit": {
                    name: "退出",
                    icon: function () {
                        return 'context-menu-icon context-menu-icon-quit';
                    }
                }
            }
        });

        /*模态框消失后事件*/
        $('#funcProblemModal').on('hidden.bs.modal', function (e) {
            // do something...
            // projectFunctionVue.problemTbSelectId = 0;
        });

        $(function(){
            $(".modal-dialog").draggable();
        });

        $.contextMenu({
            selector: '#collapse-10',
            callback: function (key, options) {
                if(key == "add") {
                    // if(projectFunctionVue.problemList.length > 0){
                    //     $.showWarningToast("已经存在问题单.");
                    //     return;
                    // }
                    if(!functionItem){
                        $.showWarningToast("请先在左侧选择一个函数.");
                        return;
                    }
                    problemOrdertype = key;
                    resetFuncProblemModal();
                    openFuncProblemModal(false);
                } else if(key == "search") {
                    problemOrdertype = key;
                    problemId = projectFunctionVue.problemTbSelectId;
                    if (problemId === 0) {
                        $.showWarningToast("请先选中一个问题单");
                        return;
                    }
                    setFuncProblemModal(problemId);
                    openFuncProblemModal(true);
                } else if(key == "modify") {
                    problemOrdertype = key;
                    problemId = projectFunctionVue.problemTbSelectId;
                    if (problemId === 0) {
                        $.showWarningToast("请先选中一个问题单");
                        return;
                    }
                    setFuncProblemModal(problemId);
                    openFuncProblemModal(false);
                } else if(key == "delete") {
                    problemOrdertype = key;
                    problemId = projectFunctionVue.problemTbSelectId;
                    if (problemId === 0) {
                        $.showWarningToast("请先选中一个问题单");
                        return;
                    }

                    swal("你确认要删除当前所选问题单吗?", {
                        buttons: ["取消", "确认"]
                    }).then(function(res){
                        if(res){
                            deleteFuncProblemModal(problemId, functionName);
                        }
                    });
                }
            },
            items: {
                "add": {
                    name: "增加",
                    icon: "add",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-application';
                    }
                },
                "search": {
                    name: "查看",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-arrange-bring-forward';
                    }
                },
                "modify": {
                    name: "修改",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-arrange-send-backward';
                    }
                },
                "delete": {
                    name: "删除",
                    icon: 'delete'
                },
                "sep1": "---------",
                "quit": {
                    name: "退出",
                    icon: function () {
                        return 'context-menu-icon context-menu-icon-quit';
                    }
                }
            }
        });
        $.contextMenu({
            selector: '#collapse-11',
            callback: function (key, options) {
                if (key == "upload"){
                    // $("#sigenal-dropzone").addClass("dropzone");
                    if(!functionItem){
                        $.showWarningToast("请先在左侧选择一个函数.");
                        return;
                    }
                    sigenalUploadVue.fileType = 1;
                    $('#uploadModal').modal('show');
                }
            },
            items: {
                "upload": {
                    name: "上传",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-arrow-up-bold-circle-outline'
                    }
                },
                "sep1": "---------",
                "quit": {
                    name: "退出",
                    icon: function () {
                        return 'context-menu-icon context-menu-icon-quit';
                    }
                }
            }
        });
        $.contextMenu({
            selector: '#collapse-12',
            callback: function (key, options) {
                if (key == "upload"){
                    // $("#sigenal-dropzone").addClass("dropzone");
                    if(!functionItem){
                        $.showWarningToast("请先在左侧选择一个函数.");
                        return;
                    }
                    sigenalUploadVue.fileType = 2;
                    $('#uploadModal').modal('show');
                }
            },
            items: {
                "upload": {
                    name: "上传",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-arrow-up-bold-circle-outline'
                    }
                },
                "sep1": "---------",
                "quit": {
                    name: "退出",
                    icon: function () {
                        return 'context-menu-icon context-menu-icon-quit';
                    }
                }
            }
        });
        $.contextMenu({
            selector: '#collapse-13',
            callback: function (key, options) {
                if (key == "upload"){
                    // $("#sigenal-dropzone").addClass("dropzone");
                    if(!functionItem){
                        $.showWarningToast("请先在左侧选择一个函数.");
                        return;
                    }
                    sigenalUploadVue.fileType = 3;
                    $('#uploadModal').modal('show');
                }
            },
            items: {
                "upload": {
                    name: "上传",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-arrow-up-bold-circle-outline'
                    }
                },
                "sep1": "---------",
                "quit": {
                    name: "退出",
                    icon: function () {
                        return 'context-menu-icon context-menu-icon-quit';
                    }
                }
            }
        });

        // $.contextMenu({
        //     selector: '#screenShotTable',
        //     callback: function (key, options) {
        //         if(key == "add") {
        //             openScreenShotModal();
        //         } else if(key == "delete") {
        //
        //         } else if(key == "modify") {
        //             openScreenShotModal();
        //         }
        //     },
        //     items: {
        //         "add": {
        //             name: "增加",
        //             //icon: "add"
        //             icon: function () {
        //                 return 'context-menu-icon mdi mdi-application';
        //             }
        //         },
        //         "delete": {
        //             name: "删除",
        //             icon: function () {
        //                 return 'context-menu-icon mdi mdi-arrange-bring-forward';
        //             }
        //         },
        //         "modify": {
        //             name: "修改",
        //             icon: function () {
        //                 return 'context-menu-icon mdi mdi-arrange-send-backward';
        //             }
        //         },
        //         "sep1": "---------",
        //         "quit": {
        //             name: "退出",
        //             icon: function () {
        //                 return 'context-menu-icon context-menu-icon-quit';
        //             }
        //         }
        //     }
        // });

        if ($("#testTime").length) {
            $('#testTime').datepicker({
                enableOnReadonly: true,
                todayHighlight: true,
                format: 'yyyy-mm-dd'
            }).on("hide", function(e) {
                //var testTime = e.date.getFullYear() + "-" + (e.date.getMonth() + 1) + "-" + e.date.getDate();
                var testTime = $("#myDate").val();
                problemModal.testTime = testTime;
            });
        }

        $("#js-grid-problem").jsGrid({
            //height: "750px",
            width: "100%",

            sorting: true,
            paging: true,
            pageSize: 20,
            //filtering: true,
            pageButtonCount: 5,
            autoload: true,
            deleteConfirm: "你确定要删除当前项吗?",
            pagerFormat: "{first} {prev} {pages} {next} {last}",
            pagePrevText: "上一页",
            pageNextText: "下一页",
            pageFirstText: "首页",
            pageLastText: "尾页",
            pageLoading: true,
            controller: {
                loadData: function (filter) {
                    return $.ajax({
                        type: "post",
                        url: "/problem/getList?project=" + [[${project}]] + "&version=" + [[${version}]],
                        contentType: "application/json",
                        dataType: "json",
                        data: JSON.stringify(filter),
                        success: function(res){
                            if(jsGridProblemItem.id == 0){
                                jsGridProblemItem = res.data[0];
                            }
                        }
                    });
                }
            },

            fields: [{
                name: "funcName",
                title: '被测函数',
                type: "text",
                width: 100
            },
                {
                    name: "testPerson",
                    title: '测试人',
                    type: "text",
                    width: 50
                },
                {
                    name: "testTime",
                    title: '测试时间',
                    type: "text",
                    width: 50
                    /*,
                    itemTemplate: function (value, item) {
                        //<div class="badge badge-info">Info</div>

                        var className = "badge-info";
                        if (item.status == 1) {
                            className = "badge-warning"
                        }
                        else if (item.status == 2) {
                            className = "badge-danger"
                        }
                        return $("<div>").addClass("badge").addClass(className).append(value)
                    }*/
                },
                {
                    name: "problemDescription",
                    title: "问题描述",
                    type: "text",
                    width: 400
                    /*
                    itemTemplate: function (value, item) {
                        return $("<div>").addClass("badge badge-warning").append(value)
                    }*/
                }
            ],
            onDataLoaded: function(args) {
                funcGridClick();
            },
            onPageChanged: function(args) {
                setTimeout(function () {
                    funcGridClick();
                }, 1000);
                console.log(args.pageIndex);
            },
            rowClass: function (item, itemIndex) {
                if(jsGridProblemItem){
                    if(item.id == jsGridProblemItem.id){
                        return "grid-select-my";
                    }
                }
            },
            rowClick: function (args) {
                //todo 表格单击事件
                jsGridProblemItem = args.item;
            } //行click
        });

        $.contextMenu({
            selector: '#js-grid-problem',
            callback: function (key, options) {
                if(key == "look") {
                    problemId = jsGridProblemItem.id;
                    if (problemId === 0) {
                        $.showWarningToast("请先选中一个问题单");
                        return;
                    }
                    setFuncProblemModal(problemId);
                    openFuncProblemModal(true);
                } else if(key == "delete") {
                    problemOrdertype = key;
                    problemId = jsGridProblemItem.id;
                    if (problemId === 0) {
                        $.showWarningToast("请先选中一个问题单");
                        return;
                    }
                    swal("你确认要删除当前所选问题单吗?", {
                        buttons: ["取消", "确认"]
                    }).then(function(res){
                        if(res){
                            $.ajax({
                                type: "post",
                                url: "/problem/deleteProblemById?problemId=" + problemId + "&functionName=" + jsGridProblemItem.funcName + "&projectName=" + projectName + "&projectVersion=" + projectVersion,
                                contentType: "application/json",
                                dataType: "json",
                                success: function(result){
                                    if(result.code == 0){
                                        $.showSuccessToast("删除问题单成功.");
                                        $("#js-grid-problem").jsGrid("render");
                                    }
                                }
                            });
                        }
                    });
                } else if(key == "modify2") {
                    problemOrdertype = key;
                    problemId = jsGridProblemItem.id;
                    if (problemId === 0) {
                        $.showWarningToast("请先选中一个问题单");
                        return;
                    }
                    setFuncProblemModal(problemId);
                    openFuncProblemModal(false);
                }
            },
            items: {
                "look": {
                    name: "查看",
                    //icon: "add"
                    icon: function () {
                        return 'context-menu-icon mdi mdi-application';
                    }
                },
                "delete": {
                    name: "删除",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-arrange-bring-forward';
                    }
                },
                "modify2": {
                    name: "修改",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-arrange-send-backward';
                    }
                },
                "sep1": "---------",
                "quit": {
                    name: "退出",
                    icon: function () {
                        return 'context-menu-icon context-menu-icon-quit';
                    }
                }
            }
        });

        $("#js-grid-report").jsGrid({
            height: "664px",
            width: "100%",

            sorting: true,
            paging: true,
            pageSize: 15,
            //filtering: true,
            pageButtonCount: 5,
            autoload: true,
            deleteConfirm: "你确定要删除当前项吗?",
            pagerFormat: "{first} {prev} {pages} {next} {last}",
            pagePrevText: "上一页",
            pageNextText: "下一页",
            pageFirstText: "首页",
            pageLastText: "尾页",
            pageLoading: true,
            controller: {
                loadData: function (filter) {
                    return $.ajax({
                        type: "post",
                        url: "/report/selectAllReport?project=" + [[${project}]] + "&version=" + [[${version}]],
                        contentType: "application/json",
                        dataType: "json",
                        data: JSON.stringify(filter)
                    });
                }
            },
            onDataLoaded: function(args) {
                $("#js-grid-report .jsgrid-grid-body").css("height", "580px");
            },
            onPageChanged: function(args) {

            },
            fields: [{
                name: "name",
                title: '名称',
                type: "text",
                itemTemplate: function (value, item) {
                    //return $("<a href='#'>").append(value)
                    return $("<a>").attr("href", "/file-upload/downloadReport?fileName="+ encodeURIComponent(item.url) + "&reportName=" + item.name).append(value);
                }
            },
                {
                    name: "fileType",
                    title: '类型',
                    type: "text",
                    itemTemplate: function (value, item) {
                        //<div class="badge badge-info">Info</div>

                        var className = "badge-info";
                        var show = "说明报告"
                        if (item.fileType == 1) {
                            className = "badge-warning"
                            show = "测试报告"
                        }
                        return $("<div>").addClass("badge").addClass(className).append(show)
                    }
                },
                {
                    name: "createPerson",
                    title: '生成人',
                    type: "text",
                    itemTemplate: function (value, item) {
                        //<div class="badge badge-info">Info</div>

                        var className = "badge-info";
                        if (item.status == 1) {
                            className = "badge-warning"
                        }
                        else if (item.status == 2) {
                            className = "badge-danger"
                        }
                        return $("<div>").addClass("badge").append(value)
                    }
                },
                {
                    name: "createTime",
                    title: "生成时间",
                    type: "text",
                    itemTemplate: function (value, item) {
                        if(value && value.length >= 10){
                            value = value.substr(0,10);
                        }
                        return $("<div>").addClass("badge").append(value)
                    }
                },
                // {
                //     name: "url",
                //     title: "下载",
                //     itemTemplate: function (value, item) {
                //         // <button type="button" class="btn btn-light">Light</button>
                //         // return $("<button>").attr("onclick", "download('" + value + "')").addClass("btn btn-light").append("下载")
                //         return $("<a>").attr("href", "/file-upload/downloadReport?fileName="+ encodeURIComponent(value) + "&reportName=" + item.name).addClass("btn btn-light").append("下载")
                //     }
                // },
                {
                    name: "address",
                    title: '说明',
                    type: "text",
                    itemTemplate: function (value, item) {
                        //return $("<a href='#'>").append(value)

                        if(value){
                            var name = "";
                            if(value.indexOf("/") >= 0){
                                name = value.substring(value.lastIndexOf("/")+1);
                            }else if(value.indexOf("\\") >= 0) {
                                name = value.substring(value.lastIndexOf("\\")+1);
                            }
                            return $("<a>").attr("href", "/file-upload/downloadReport?fileName="+ encodeURIComponent(item.address) + "&reportName=" + name).append(name);
                        }else {
                            return "";
                        }
                    }
                }
            ],
            rowClick: function (args) {
                //todo 表格单击事件
                // console.log(args);
            } //行click
        });

        $("#tcf-dropzone").dropzone({
            url: "/file-upload/all?project=" + [[${project}]] + "&version=" + [[${version}]] + "&projectName=" + projectName,
            // uploadMultiple: false,
            method: "post",  //也可用put
            paramName: "file", //默认为file
            maxFiles: 10,//一次性上传的文件数量上限
            maxFilesize: 200, //MB
            acceptedFiles: ".rar", //上传的类型
            timeout: 180000,
            // previewsContainer: "#adds", //显示的容器
            parallelUploads: 10,
            uploadMultiple: true,
            dictDefaultMessage: '拖动文件至此或者点击上传', // 设置默认的提示语句
            dictMaxFilesExceeded: "您最多只能上传1个文件！",
            dictResponseError: '文件上传失败!',
            dictInvalidFileType: "你不能上传该类型文件,文件类型只能是*.rar。",
            dictFallbackMessage: "浏览器不受支持",
            dictFileTooBig: "文件过大上传文件最大支持.",
            // previewTemplate: document.querySelector("#preview-template").innerHTML,//设置显示模板
            previewTemplate: "<div class=\"dz-preview dz-file-preview\" style='display: inline-block'>\n  <div class=\"dz-image\"><img data-dz-thumbnail /></div>\n  <div class=\"dz-details\">\n    <div class=\"dz-size\"><span data-dz-size></span></div>\n    <div class=\"dz-filename\"><span data-dz-name></span></div>\n  </div>\n  <div class=\"dz-progress\"><span class=\"dz-upload\" data-dz-uploadprogress></span></div>\n  <div class=\"dz-error-message\"><span data-dz-errormessage></span></div>\n  <div class=\"dz-success-mark\">\n    <svg width=\"54px\" height=\"54px\" viewBox=\"0 0 54 54\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:sketch=\"http://www.bohemiancoding.com/sketch/ns\">\n      <title>Check</title>\n      <defs></defs>\n      <g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\" sketch:type=\"MSPage\">\n        <path d=\"M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\" id=\"Oval-2\" stroke-opacity=\"0.198794158\" stroke=\"#747474\" fill-opacity=\"0.816519475\" fill=\"#FFFFFF\" sketch:type=\"MSShapeGroup\"></path>\n      </g>\n    </svg>\n  </div>\n  <div class=\"dz-error-mark\">\n    <svg width=\"54px\" height=\"54px\" viewBox=\"0 0 54 54\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:sketch=\"http://www.bohemiancoding.com/sketch/ns\">\n      <title>Error</title>\n      <defs></defs>\n      <g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\" sketch:type=\"MSPage\">\n        <g id=\"Check-+-Oval-2\" sketch:type=\"MSLayerGroup\" stroke=\"#747474\" stroke-opacity=\"0.198794158\" fill=\"#FFFFFF\" fill-opacity=\"0.816519475\">\n          <path d=\"M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\" id=\"Oval-2\" sketch:type=\"MSShapeGroup\"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>",
            accept: function(file, done) {
                swal("你确定要上传文件 ["+file.name+"]吗？", {
                    buttons: ["取消", "确认"]
                }).then(function(res){
                    if(res){
                        done();
                    }else{
                        done("文件被取消上传.");
                    }
                });
            },
            init: function () {
                this.on("addedfile", function (file) {
                    progressChange("tcf-progress", 0);
                    //上传文件时触发的事件
                    $("input[type='file']").each(function(i){
                        $(this).attr("disabled", true);
                    });
                });
                this.on("queuecomplete", function (file) {
                    //上传队列中的所有文件完成后触发的方法
                    $(".dz-hidden-input").attr("disabled",false);
                    $("#analysisIng").css("display", "none");
                    $("#analysisComplete").css("display", "inline-block");
                    refreshFileTable();
                });
                this.on('totaluploadprogress', function (progress, byte, bytes) {
                    //用 uploadProgress (0-100), totalBytes 和 totalBytesSent的总数调用. 此事件可以用于显示所有文件的总体上传进度.
                    //console.log(parseInt(progress));
                    progressChange("tcf-progress", progress);
                    $("input[type='file']").each(function(i){
                        $(this).attr("disabled", true);
                    });
                });
                this.on("removedfile", function (file) {
                    //删除文件时触发的方法
                });
                this.on("success", function (file,result) {
                    //文件已经成功上传，获得服务器返回信息作为第二个参数(这个时间又被称作finished)
                    if(result.code == 16){
                        $("#uploadResult").html(result.msg).css("color", "red");
                        $.showDangerToast(result.msg);
                    } if(result.code == 0) {
                        $("#uploadResult").html("解析成功.").css("color", "green");
                    }
                });
            }
        });

        $("#converage-dropzone").dropzone({
            url: "/file-upload/coverage?project=" + [[${project}]] + "&version=" + [[${version}]],
            // uploadMultiple: false,
            method: "post",  //也可用put
            // paramName: "Filedata", //默认为file
            maxFiles: 10,//一次性上传的文件数量上限
            maxFilesize: 20, //MB
            acceptedFiles: ".rar", //上传的类型
            // previewsContainer: "#adds", //显示的容器
            parallelUploads: 10, //一次性上传的文件数量
            uploadMultiple: true,
            dictDefaultMessage: '拖动文件至此或者点击上传', // 设置默认的提示语句
            dictMaxFilesExceeded: "您最多只能上传10个文件！",
            dictResponseError: '文件上传失败!',
            dictInvalidFileType: "你不能上传该类型文件,文件类型只能是*.rar。",
            dictFallbackMessage: "浏览器不受支持",
            dictFileTooBig: "文件过大上传文件最大支持.",
            // previewTemplate: document.querySelector("#preview-template").innerHTML,//设置显示模板
            previewTemplate: "<div class=\"dz-preview dz-file-preview\" style='display: inline-block'>\n  <div class=\"dz-image\"><img data-dz-thumbnail /></div>\n  <div class=\"dz-details\">\n    <div class=\"dz-size\"><span data-dz-size></span></div>\n    <div class=\"dz-filename\"><span data-dz-name></span></div>\n  </div>\n  <div class=\"dz-progress\"><span class=\"dz-upload\" data-dz-uploadprogress></span></div>\n  <div class=\"dz-error-message\"><span data-dz-errormessage></span></div>\n  <div class=\"dz-success-mark\">\n    <svg width=\"54px\" height=\"54px\" viewBox=\"0 0 54 54\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:sketch=\"http://www.bohemiancoding.com/sketch/ns\">\n      <title>Check</title>\n      <defs></defs>\n      <g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\" sketch:type=\"MSPage\">\n        <path d=\"M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\" id=\"Oval-2\" stroke-opacity=\"0.198794158\" stroke=\"#747474\" fill-opacity=\"0.816519475\" fill=\"#FFFFFF\" sketch:type=\"MSShapeGroup\"></path>\n      </g>\n    </svg>\n  </div>\n  <div class=\"dz-error-mark\">\n    <svg width=\"54px\" height=\"54px\" viewBox=\"0 0 54 54\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:sketch=\"http://www.bohemiancoding.com/sketch/ns\">\n      <title>Error</title>\n      <defs></defs>\n      <g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\" sketch:type=\"MSPage\">\n        <g id=\"Check-+-Oval-2\" sketch:type=\"MSLayerGroup\" stroke=\"#747474\" stroke-opacity=\"0.198794158\" fill=\"#FFFFFF\" fill-opacity=\"0.816519475\">\n          <path d=\"M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\" id=\"Oval-2\" sketch:type=\"MSShapeGroup\"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>",
            init: function () {
                this.on("addedfile", function (file) {
                    progressChange("tcf-progress", 0);
                    //上传文件时触发的事件
                    $("input[type='file']").each(function(i){
                        $(this).attr("disabled", true);
                    });
                });
                this.on("queuecomplete", function (file) {
                    //上传队列中的所有文件完成后触发的方法
                    $(".dz-hidden-input").attr("disabled",false);
                });
                this.on('totaluploadprogress', function (progress, byte, bytes) {
                    //用 uploadProgress (0-100), totalBytes 和 totalBytesSent的总数调用. 此事件可以用于显示所有文件的总体上传进度.
                    //console.log(parseInt(progress));
                    progressChange("coverage-progress", progress);
                    $("input[type='file']").each(function(i){
                        $(this).attr("disabled", true);
                    });
                });
                this.on("removedfile", function (file, errorMessage) {
                    //删除文件时触发的方法
                });
                this.on("error", function () {
                    progressChange("coverage-progress", 0);
                });
            }
        });

        var selectedItems1 = [];
        var selectedItems2 = [];
        var selectedItems3 = [];
        var selectItem = function(num,item) {
            if(num == 1){
                selectedItems1.push(item);
            } else if(num == 2){
                selectedItems2.push(item);
            } else if(num == 3){
                selectedItems3.push(item);
            }
        };
        var unselectItem = function(num,item) {
            if(num == 1){
                selectedItems1 = $.grep(selectedItems1, function(i) {
                    return i !== item;
                });
            } else if(num == 2){
                selectedItems2 = $.grep(selectedItems2, function(i) {
                    return i !== item;
                });
            } else if(num == 3){
                selectedItems3 = $.grep(selectedItems3, function(i) {
                    return i !== item;
                });
            }
        };
        var changeAllItem = function(num,checked) {
            if(num == 1){
                $("#js-grid-tcf input[type='checkbox']").prop("checked",checked);
                if(checked == true){
                    selectedItems1 = $("#js-grid-tcf").jsGrid("option", "data");
                }else{
                    selectedItems1 = [];
                }
            } else if(num == 2){
                $("#js-grid-coverage input[type='checkbox']").prop("checked",checked);
                if(checked == true){
                    selectedItems2 = $("#js-grid-coverage").jsGrid("option", "data");
                }else{
                    selectedItems2 = [];
                }
            } else if(num == 3){
                $("#js-grid-picture input[type='checkbox']").prop("checked",checked);
                if(checked == true){
                    selectedItems3 = $("#js-grid-picture").jsGrid("option", "data");
                }else{
                    selectedItems3 = [];
                }
            }
        };
        var deleteSelectedItems = function(selectedItems, url, grid, name) {
            if(!selectedItems.length){
                return;
            }
            swal("你确认要删除当前所选项吗?", {
                buttons: ["取消", "确认"]
            }).then(function(res){
                if(res){
                    $.ajax({
                        type: "post",
                        url: url,
                        data: JSON.stringify(selectedItems),
                        contentType: "application/json",
                        dataType: "json",
                        success: function (result) {
                            if(result.code == 0){
                                $.showSuccessToast("删除成功.");
                                var $grid = $(grid);
                                $grid.jsGrid("option", "pageIndex", 1);
                                $grid.jsGrid("loadData");
                                selectedItems = [];
                                var t = $(grid+" input[name='"+name+"']").prop("checked",false);
                            }
                        },
                        error: function(data){

                        }
                    });
                }
            });
        };

        $("#js-grid-tcf").jsGrid({
            height: "630px",
            width: "100%",

            sorting: true,
            paging: true,
            pageSize: 15,
            // filtering: true,
            pageButtonCount: 3,
            autoload: true,
            deleteConfirm: "你确定要删除当前项吗?",
            pagerFormat: "{first} {prev} {pages} {next} {last}",
            pagePrevText: "上一页",
            pageNextText: "下一页",
            pageFirstText: "首页",
            pageLastText: "尾页",
            pageLoading: true,
            controller: {
                loadData: function (filter) {
                    return $.ajax({
                        type: "post",
                        url: "/proVerTcfList?project=" + [[${project}]] + "&version=" + [[${version}]],
                        data: JSON.stringify(filter),
                        contentType: "application/json",
                        dataType: "json",
                    });
                }
            },
            onDataLoaded: function(args) {
                // $("#js-grid-tcf .jsgrid-grid-body").css("height", "560px");
            },
            onPageChanged: function(args) {

            },
            fields: [
                {
                    headerTemplate: function() {
                        return $("<input>").attr("type", "checkbox")
                            .attr("name", "tcfCheckAll")
                            // .prop("checked", selectAllTcf)
                            .on("change", function (event) {
                                $(this).is(":checked") ? changeAllItem(1, true) : changeAllItem(1, false);
                            })
                            .on("click", function(event) {
                                event.stopPropagation();//阻止冒泡
                            });
                    },
                    itemTemplate: function(_, item) {
                        return $("<input>").attr("type", "checkbox")
                            .prop("checked", $.inArray(item, selectedItems1) > -1)
                            .on("change", function () {
                                $(this).is(":checked") ? selectItem(1,item) : unselectItem(1,item);
                            });
                    },
                    align: "center",
                    width: 30
                },
                {
                    name: "fileName",
                    title: 'tcf文件名称',
                    type: "text",
                    width: 80,
                    itemTemplate: function (value, item) {
                        //return $("<a href='#'>").append(value)
                        return $("<a>").attr("href", "/file-upload/downloadUp?fileName="+ encodeURIComponent(item.fileUrl) + "&reportName=" + item.fileName).append(value);
                    }
                },
                {
                    name: "functionName",
                    title: '函数名称',
                    type: "text",
                    width: 80,
                    itemTemplate: function (value, item) {
                        //<div class="badge badge-info">Info</div>

                        var className = "badge-info";
                        if (item.status == 1) {
                            className = "badge-warning"
                        }
                        else if (item.status == 2) {
                            className = "badge-danger"
                        }
                        return $("<div>").append(value)
                    }
                },
                // {
                //     name: "num",
                //     title: '用例编号',
                //     type: "text",
                //     width: 55
                // },
                // {
                //     name: "createPerson",
                //     title: "提交人",
                //     type: "text",
                //     itemTemplate: function (value, item) {
                //         return $("<div>").addClass("badge badge-warning").append(value)
                //     }
                // },
                // {
                //     name: "createTime",
                //     title: "提交时间",
                //     type: "text",
                //     itemTemplate: function (value, item) {
                //         return $("<div>").addClass("badge badge-warning").append(value)
                //     }
                // }
            ],
            rowClick: function (args) {
                //todo 表格单击事件
            } //行click
        });
        $.contextMenu({
            selector: '#js-grid-tcf',
            callback: function (key, options) {
                if(key == "delete") {
                    deleteSelectedItems(selectedItems1, "/deleteProVerTcfList", "#js-grid-tcf", "tcfCheckAll");
                }
            },
            items: {
                "delete": {
                    name: "删除",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-arrange-bring-forward';
                    }
                },
                "sep1": "---------",
                "quit": {
                    name: "退出",
                    icon: function () {
                        return 'context-menu-icon context-menu-icon-quit';
                    }
                }
            }
        });
        $("#js-grid-coverage").jsGrid({
            height: "630",
            width: "100%",

            sorting: true,
            paging: true,
            pageSize: 15,
            // filtering: true,
            pageButtonCount: 3,
            autoload: true,
            deleteConfirm: "你确定要删除当前项吗?",
            pagerFormat: "{first} {prev} {pages} {next} {last}",
            pagePrevText: "上一页",
            pageNextText: "下一页",
            pageFirstText: "首页",
            pageLastText: "尾页",
            pageLoading: true,
            controller: {
                loadData: function (filter) {
                    return $.ajax({
                        type: "post",
                        url: "/proVerCoverageList?project=" + [[${project}]] + "&version=" + [[${version}]],
                        data: JSON.stringify(filter),
                        contentType: "application/json",
                        dataType: "json",
                    });
                }
            },
            onDataLoaded: function(args) {
                // $("#js-grid-coverage .jsgrid-grid-body").css("height", 560-12+"px");
                // setTimeout(function () {
                //     merge();
                // },10);
            },
            onPageChanged: function(args) {
                // setTimeout(function () {
                //     merge();
                // },10);
            },
            fields: [
                {
                    headerTemplate: function() {
                        return $("<input>").attr("type", "checkbox")
                            .attr("name", "coverageCheckAll")
                            .on("change", function (event) {
                                $(this).is(":checked") ? changeAllItem(2, true) : changeAllItem(2, false);
                            })
                            .on("click", function(event) {
                                event.stopPropagation();//阻止冒泡
                            });
                    },
                    itemTemplate: function(_, item) {
                        return $("<input>").attr("type", "checkbox")
                            .prop("checked", $.inArray(item, selectedItems2) > -1)
                            .on("change", function () {
                                $(this).is(":checked") ? selectItem(2,item) : unselectItem(2,item);
                            });
                    },
                    align: "center",
                    width: 30
                },
                {
                    name: "fileName",
                    title: '覆盖率文件名称',
                    type: "text",
                    width: 80,
                    itemTemplate: function (value, item) {
                        //return $("<a href='#'>").append(value)
                        return $("<a>").attr("href", "/file-upload/downloadUp?fileName="+ encodeURIComponent(item.fileUrl) + "&reportName=" + item.fileName).append(value);
                    }
                },
                {
                    name: "functionName",
                    title: '函数名称',
                    type: "text",
                    width: 100,
                    itemTemplate: function (value, item) {
                        //<div class="badge badge-info">Info</div>

                        var className = "badge-info";
                        // if (item.status == 1) {
                        //     className = "badge-warning"
                        // }
                        // else if (item.status == 2) {
                        //     className = "badge-danger"
                        // }
                        return $("<div>").append(value)
                    }
                },
                {
                    name: "statementCoverage",
                    title: "语句",
                    type: "text",
                    width: 28
                },
                {
                    name: "branchCoverage",
                    title: "分支",
                    type: "text",
                    width: 28,
                    itemTemplate: function (value, item) {
                        //return $("<a href='#'>").append(value)
                        if(value === null || value === undefined || value === ''){
                            return $("<div>").append("\\");
                        }
                        return $("<div>").append(value);
                    }
                },
                {
                    name: "mcdcCoverage",
                    title: "MC/DC",
                    type: "text",
                    width: 30
                }
                // {
                //     name: "createPerson",
                //     title: "提交人",
                //     type: "text",
                //     itemTemplate: function (value, item) {
                //         return $("<div>").addClass("badge badge-warning").append(value)
                //     }
                // },
                // {
                //     name: "createTime",
                //     title: "提交时间",
                //     type: "text",
                //     itemTemplate: function (value, item) {
                //         return $("<div>").addClass("badge badge-warning").append(value)
                //     }
                // }
            ],
            rowClick: function (args) {
                //todo 表格单击事件
                // console.log(args);
            } //行click
        });
        $.contextMenu({
            selector: '#js-grid-coverage',
            callback: function (key, options) {
                if(key == "delete") {
                    deleteSelectedItems(selectedItems2, "/deleteProVerCoverageList", "#js-grid-coverage", "coverageCheckAll");
                }
            },
            items: {
                "delete": {
                    name: "删除",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-arrange-bring-forward';
                    }
                },
                "sep1": "---------",
                "quit": {
                    name: "退出",
                    icon: function () {
                        return 'context-menu-icon context-menu-icon-quit';
                    }
                }
            }
        });
        $("#js-grid-picture").jsGrid({
            height: "630px",
            width: "100%",

            sorting: true,
            paging: true,
            pageSize: 15,
            // filtering: true,
            pageButtonCount: 3,
            autoload: true,
            deleteConfirm: "你确定要删除当前项吗?",
            pagerFormat: "{first} {prev} {pages} {next} {last}",
            pagePrevText: "上一页",
            pageNextText: "下一页",
            pageFirstText: "首页",
            pageLastText: "尾页",
            pageLoading: true,
            controller: {
                loadData: function (filter) {
                    return $.ajax({
                        type: "post",
                        url: "/proVerPictureList?project=" + [[${project}]] + "&version=" + [[${version}]],
                        data: JSON.stringify(filter),
                        contentType: "application/json",
                        dataType: "json",
                    });
                }
            },
            onDataLoaded: function(args) {
                // $("#js-grid-picture .jsgrid-grid-body").css("height", "560px");
            },
            onPageChanged: function(args) {

            },
            fields: [
                {
                    headerTemplate: function() {
                        // return $("<button>").attr("type", "button").addClass("btn btn-sm btn-outline-light btn-rounded").text("D")
                        //     .on("click", function (event) {
                        //         event.preventDefault();//阻止默认事件
                        //         event.stopPropagation();//阻止冒泡
                        //         var button = $(this);
                        //         deleteSelectedItems(3, button);
                        //     });
                        return $("<input>").attr("type", "checkbox")
                            .attr("name", "pictureCheckAll")
                            // .prop("checked", selectedItems3.length != 0)
                            .on("change", function (event) {
                                $(this).is(":checked") ? changeAllItem(3, true) : changeAllItem(3, false);
                            })
                            .on("click", function(event) {
                                event.stopPropagation();//阻止冒泡
                            });
                    },
                    itemTemplate: function(_, item) {
                        return $("<input>").attr("type", "checkbox")
                            .prop("checked", $.inArray(item, selectedItems3) > -1)
                            .on("change", function () {
                                $(this).is(":checked") ? selectItem(3,item) : unselectItem(3,item);
                            });
                    },
                    align: "center",
                    width: 30
                },
                {
                    name: "fileName",
                    title: '截图文件名称',
                    type: "text",
                    width: 100,
                    itemTemplate: function (value, item) {
                        //return $("<a href='#'>").append(value)
                        return $("<a>").attr("href", "/file-upload/downloadUp?fileName="+ encodeURIComponent(item.fileUrl) + "&reportName=" + item.fileName).append(value);
                    }
                },
                {
                    name: "functionName",
                    title: '函数名称',
                    type: "text",
                    width: 100,
                    itemTemplate: function (value, item) {
                        //<div class="badge badge-info">Info</div>

                        var className = "badge-info";
                        if (item.status == 1) {
                            className = "badge-warning"
                        }
                        else if (item.status == 2) {
                            className = "badge-danger"
                        }
                        return $("<div>").append(value)
                    }
                },
                {
                    name: "fileType",
                    title: "文件类型",
                    type: "text",
                    width: 50,
                    itemTemplate: function (value, item) {
                        //<div class="badge badge-info">Info</div>

                        var className = "badge-info";
                        var show = "";
                        if (value == 1) {
                            className = "badge-warning";
                            show="测试路径";
                        }
                        else if (value == 2) {
                            className = "badge-danger"
                            show="语句覆盖率"
                        }else if (value == 3) {
                            className = "badge-info"
                            show="分支覆盖率"
                        }
                        return $("<div>").addClass("badge").addClass(className).append(show);
                    }
                }
                // {
                //     name: "createPerson",
                //     title: "提交人",
                //     type: "text",
                //     itemTemplate: function (value, item) {
                //         return $("<div>").addClass("badge badge-warning").append(value)
                //     }
                // },
                // {
                //     name: "createTime",
                //     title: "提交时间",
                //     type: "text",
                //     itemTemplate: function (value, item) {
                //         return $("<div>").addClass("badge badge-warning").append(value)
                //     }
                // }
            ],
            rowClick: function (args) {
                //todo 表格单击事件
                // console.log(args);
            } //行click
        });
        $.contextMenu({
            selector: '#js-grid-picture',
            callback: function (key, options) {
                if(key == "delete") {
                    deleteSelectedItems(selectedItems3, "/deleteProVerPictureList", "#js-grid-picture", "pictureCheckAll");
                }
            },
            items: {
                "delete": {
                    name: "删除",
                    icon: function () {
                        return 'context-menu-icon mdi mdi-arrange-bring-forward';
                    }
                },
                "sep1": "---------",
                "quit": {
                    name: "退出",
                    icon: function () {
                        return 'context-menu-icon context-menu-icon-quit';
                    }
                }
            }
        });
        getWordmuban(1);
        getWordmuban(2);

        // //以jquery为例实现点击某行获得某个td的数据
        // $( "#problemTable tr" ).click( function() {//给每行绑定了一个点击事件
        //     var trs = $(this).parent().find('tr'); //获取所有tr
        //     if (trs.hasClass('grid-select-my')) { //判断这些tr 有没有Class ‘on’’
        //         trs.removeClass('grid-select-my');//把class on 移除
        //     }
        //     $(this).addClass('grid-select-my');//点击的tr 添加 on class 用于改变样式
        //
        //     var td = $( this ).find( "td" );//this指向了当前点击的行，通过find我们获得了该行所有的td对象
        //     //题中说到某个td，为了演示所以我们假设是要获得第3个td的数据
        //     var data = td.eq(0).html();//通过eq可以得到具体的某个td对象，从而得到相应的数据
        //     alert(data);
        // } );

        $('.dropify').dropify();
    });
</script>
</body>
</html>
